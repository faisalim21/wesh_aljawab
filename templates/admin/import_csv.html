{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block title %}Ø±ÙØ¹ Ø£Ø³Ø¦Ù„Ø© Ù„Ù„Ø­Ø²Ù…Ø© Ø±Ù‚Ù… {{ package.package_number }}{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
/* â€”â€” Ù†ÙØ³ ØªÙ†Ø³ÙŠÙ‚Ø§ØªÙƒ â€”â€” */
.upload-container { max-width: 900px; margin: 20px auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
.package-info { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 25px; text-align: center; }
.package-info h2 { margin: 0 0 10px 0; font-size: 1.8em; }
.package-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; }
.stat-item { background: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px; text-align: center; }
.stat-number { font-size: 1.5em; font-weight: bold; display: block; }
.instructions { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #28a745; }
.quick-actions { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
.quick-action-btn { background: #17a2b8; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px; font-size: 0.9em; display: inline-flex; align-items: center; gap: 5px; }
.quick-action-btn:hover { background: #138496; color: white; }
.upload-form { background: #fff; border: 2px dashed #ddd; border-radius: 8px; padding: 30px; text-align: center; transition: all 0.3s ease; }
.upload-form:hover { border-color: #007bff; background: #f8f9ff; }
.file-input-container { position: relative; display: inline-block; margin: 20px 0; }
.file-input { position: absolute; left: -9999px; }
.file-input-label { background: #007bff; color: white; padding: 15px 30px; border-radius: 5px; cursor: pointer; display: inline-block; font-size: 1.1em; transition: background 0.3s; }
.file-input-label:hover { background: #0056b3; }
.file-selected { margin-top: 15px; padding: 10px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 5px; display: none; }
.options-section { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 15px; margin: 20px 0; }
.checkbox-container { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
.submit-section { margin-top: 25px; padding-top: 20px; border-top: 1px solid #eee; }
.upload-btn { background: #28a745; color: white; padding: 15px 40px; border: none; border-radius: 5px; font-size: 1.2em; font-weight: bold; cursor: pointer; margin: 0 10px; transition: background 0.3s; }
.upload-btn:hover { background: #218838; }
.upload-btn:disabled { background: #6c757d; cursor: not-allowed; }
.cancel-btn { background: #6c757d; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; font-size: 1.1em; margin: 0 10px; }
.cancel-btn:hover { background: #5a6268; color: white; }
.progress-bar { width: 100%; height: 4px; background: #e9ecef; border-radius: 2px; margin: 15px 0; overflow: hidden; display: none; }
.progress-fill { height: 100%; background: #007bff; width: 0%; transition: width 0.3s ease; }
@media (max-width: 768px) {
  .upload-container { margin: 10px; padding: 20px; }
  .package-stats { grid-template-columns: 1fr; }
  .quick-actions { flex-direction: column; }
  .submit-section { flex-direction: column; gap: 10px; }
  .upload-btn, .cancel-btn { width: 100%; margin: 5px 0; }
}
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  <a href="{% url 'admin:index' %}">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  &rsaquo; <a href="{{ back_url|default:'#' }}">ğŸ”¤ Ø­Ø²Ù… Ø§Ù„Ø­Ø±ÙˆÙ</a>
  &rsaquo; Ø­Ø²Ù…Ø© Ø±Ù‚Ù… {{ package.package_number }}
  &rsaquo; Ø±ÙØ¹ Ø£Ø³Ø¦Ù„Ø©
</div>
{% endblock %}

{% block content %}
<div class="upload-container">
  <div class="package-info">
    <h2>ğŸ”¤ Ø­Ø²Ù…Ø© Ø®Ù„ÙŠØ© Ø§Ù„Ø­Ø±ÙˆÙ Ø±Ù‚Ù… {{ package.package_number }}</h2>
    <div class="package-stats">
      <div class="stat-item">
        <span class="stat-number">{{ package.letters_questions.count }}</span>
        <span>Ø³Ø¤Ø§Ù„ Ù…ÙˆØ¬ÙˆØ¯</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">
          {% if package.is_free %}Ù…Ø¬Ø§Ù†ÙŠ{% else %}{{ package.price }} Ø±ÙŠØ§Ù„{% endif %}
        </span>
        <span>Ø§Ù„Ø³Ø¹Ø±</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{% if package.is_active %}ğŸŸ¢{% else %}ğŸ”´{% endif %}</span>
        <span>{% if package.is_active %}ÙØ¹Ø§Ù„Ø©{% else %}ØºÙŠØ± ÙØ¹Ø§Ù„Ø©{% endif %}</span>
      </div>
    </div>
  </div>

  <div class="instructions">
    <h3>ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø±ÙØ¹:</h3>
    <p><strong>ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</strong></p>
    <p>Ø§Ù„Ø­Ø±Ù | Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„ | Ø§Ù„Ø³Ø¤Ø§Ù„ | Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© | Ø§Ù„ØªØµÙ†ÙŠÙ</p>
    <p><strong>Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©:</strong> Ø±Ø¦ÙŠØ³ÙŠØŒ Ø¨Ø¯ÙŠÙ„1ØŒ Ø¨Ø¯ÙŠÙ„2</p>
    <p><strong>ØµÙŠØº Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©:</strong> Excel (.xlsx) Ø£Ùˆ CSV (.csv)</p>
  </div>

  <div class="quick-actions">
    {% if download_template_url %}
      <a href="{{ download_template_url }}" class="quick-action-btn">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ù„Ø¨ Excel/CSV</a>
    {% endif %}
    {% if export_url and package.letters_questions.exists %}
      <a href="{{ export_url }}" class="quick-action-btn">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</a>
    {% endif %}
    {% if change_url %}
      <a href="{{ change_url }}" class="quick-action-btn">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø²Ù…Ø©</a>
    {% endif %}
  </div>

  <form method="post" enctype="multipart/form-data" class="upload-form" id="uploadForm">
    {% csrf_token %}
    <h3>ğŸ“ Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>

    <div class="file-input-container">
      <input type="file" name="file" id="id_file" class="file-input" accept="{{ accept|default:'.csv,.xlsx' }}" required onchange="handleFileSelect(this)">
      <label for="id_file" class="file-input-label">ğŸ—‚ï¸ Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</label>
    </div>

    <div class="file-selected" id="fileSelected">
      <strong>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø±:</strong> <span id="fileName"></span>
    </div>

    {% if package.letters_questions.exists %}
    <div class="options-section">
      <h4>âš™ï¸ Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</h4>
      <div class="checkbox-container">
        <input type="checkbox" name="replace" id="id_replace">
        <label for="id_replace">
          <strong>{{ replace_label|default:"Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©" }}</strong><br>
          <small>Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯</small>
        </label>
      </div>
    </div>
    {% endif %}

    <div class="progress-bar" id="progressBar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <div class="submit-section">
      <button type="submit" class="upload-btn" id="submitBtn">{{ submit_label|default:"Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù" }}</button>
      <a href="{{ back_url|default:'#' }}" class="cancel-btn">âŒ Ø¥Ù„ØºØ§Ø¡</a>
    </div>
  </form>
</div>

<script>
function handleFileSelect(input) {
  const fileSelected = document.getElementById('fileSelected');
  const fileName = document.getElementById('fileName');
  const submitBtn = document.getElementById('submitBtn');

  if (input.files && input.files[0]) {
    const file = input.files[0];
    fileName.textContent = file.name;
    fileSelected.style.display = 'block';
    submitBtn.disabled = false;

    const validTypes = ['.xlsx', '.csv'];
    const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
    if (!validTypes.includes(fileExtension)) {
      alert('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Excel (.xlsx) Ø£Ùˆ CSV (.csv)');
      input.value = '';
      fileSelected.style.display = 'none';
      submitBtn.disabled = true;
      return;
    }
    if (file.size > 10 * 1024 * 1024) {
      alert('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ØµØºØ± Ù…Ù† 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª');
      input.value = '';
      fileSelected.style.display = 'none';
      submitBtn.disabled = true;
      return;
    }
  } else {
    fileSelected.style.display = 'none';
    submitBtn.disabled = true;
  }
}

document.getElementById('uploadForm').addEventListener('submit', function() {
  const submitBtn = document.getElementById('submitBtn');
  const progressBar = document.getElementById('progressBar');
  const progressFill = document.getElementById('progressFill');
  submitBtn.disabled = true;
  submitBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';
  progressBar.style.display = 'block';

  let progress = 0;
  const interval = setInterval(() => {
    progress += Math.random() * 15;
    if (progress > 90) progress = 90;
    progressFill.style.width = progress + '%';
  }, 200);
  setTimeout(() => { clearInterval(interval); progressFill.style.width = '100%'; }, 3000);
});

document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('submitBtn').disabled = true;
});
</script>
{% endblock %}
