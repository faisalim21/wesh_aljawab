<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
  <!-- Header Section -->
  <header class="main-header" role="banner">
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" aria-label="الشريط العلوي">
      <div class="container">
        <!-- Logo and Brand -->
        <a class="navbar-brand d-flex align-items-center" href="{% url 'home' %}" aria-label="الرئيسية - وش الجواب">
          <div class="logo-container">
            <img
              src="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png"
              alt="وش الجواب"
              class="logo-img"
              width="160"
              height="60"
              loading="eager"
              fetchpriority="high"
              decoding="async"
            />
          </div>
        </a>

        <!-- Mobile Toggle Button -->
        <button
          class="navbar-toggler custom-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="تبديل القائمة"
        >
          <span class="toggler-icon"></span>
          <span class="toggler-icon"></span>
          <span class="toggler-icon"></span>
        </button>

        <!-- Navigation Menu -->
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto" role="menubar">
            <li class="nav-item" role="none">
              <a class="nav-link" href="{% url 'home' %}" role="menuitem">
                <i class="fas fa-home me-1" aria-hidden="true"></i>
                الرئيسية
              </a>
            </li>

            <li class="nav-item dropdown" role="none">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="fas fa-gamepad me-1" aria-hidden="true"></i>
                الألعاب
              </a>
              <ul class="dropdown-menu custom-dropdown" role="menu" aria-label="قائمة الألعاب">
                <li role="none">
                  <a class="dropdown-item" href="{% url 'games:letters_home' %}" role="menuitem">
                    <span class="d-flex align-items-center">
                      <i class="fas fa-font me-2" aria-hidden="true"></i>
                      خلية الحروف
                    </span>
                    <span class="game-status-badge available">متاح</span>
                  </a>
                </li>
                <li role="none">
                  <a class="dropdown-item disabled" href="#" role="menuitem" aria-disabled="true">
                    <span class="d-flex align-items-center">
                      <i class="fas fa-images me-2" aria-hidden="true"></i>
                      تحدي الصور
                    </span>
                    <span class="game-status-badge coming-soon">قريباً</span>
                  </a>
                </li>
                <li role="none">
                  <a class="dropdown-item disabled" href="#" role="menuitem" aria-disabled="true">
                    <span class="d-flex align-items-center">
                      <i class="fas fa-question-circle me-2" aria-hidden="true"></i>
                      سؤال وجواب
                    </span>
                    <span class="game-status-badge coming-soon">قريباً</span>
                  </a>
                </li>
              </ul>
            </li>

            <li class="nav-item" role="none">
              <a class="nav-link" href="#about" role="menuitem">
                <i class="fas fa-info-circle me-1" aria-hidden="true"></i>
                حول المنصة
              </a>
            </li>
            <li class="nav-item" role="none">
              <a class="nav-link" href="#contact" role="menuitem">
                <i class="fas fa-envelope me-1" aria-hidden="true"></i>
                تواصل معنا
              </a>
            </li>
          </ul>

          <!-- User Actions -->
          <div class="navbar-nav ms-auto">
            {% if user.is_authenticated %}
            <div class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle user-menu"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <div class="user-avatar" aria-hidden="true">
                  <i class="fas fa-user"></i>
                </div>
                <span class="user-name">{{ user.profile.display_name|default:user.username }}</span>
              </a>
              <ul class="dropdown-menu custom-dropdown user-dropdown" role="menu" aria-label="قائمة المستخدم">
                <li class="dropdown-header">
                  <div class="user-info text-center">
                    <strong>{{ user.profile.display_name|default:user.username }}</strong>
                    <small class="text-muted d-block">{{ user.email }}</small>
                  </div>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li role="none">
                  <a class="dropdown-item" href="{% url 'accounts:profile' %}" role="menuitem">
                    <i class="fas fa-user-circle me-2" aria-hidden="true"></i>
                    الملف الشخصي
                  </a>
                </li>
                <li role="none">
                  <a class="dropdown-item" href="{% url 'payments:history' %}" role="menuitem">
                    <i class="fas fa-credit-card me-2" aria-hidden="true"></i>
                    مشترياتي
                  </a>
                </li>
                <li role="none">
                  <a class="dropdown-item" href="#" role="menuitem">
                    <i class="fas fa-cog me-2" aria-hidden="true"></i>
                    الإعدادات
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li role="none">
                  <a class="dropdown-item text-danger" href="{% url 'accounts:logout' %}" role="menuitem">
                    <i class="fas fa-sign-out-alt me-2" aria-hidden="true"></i>
                    تسجيل الخروج
                  </a>
                </li>
              </ul>
            </div>
            {% else %}
            <div class="auth-buttons d-flex align-items-center">
              <a href="{% url 'accounts:login' %}" class="btn btn-outline-light me-2">
                <i class="fas fa-sign-in-alt me-1" aria-hidden="true"></i>
                دخول
              </a>
              <a href="{% url 'accounts:register' %}" class="btn btn-primary">
                <i class="fas fa-user-plus me-1" aria-hidden="true"></i>
                تسجيل جديد
              </a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </nav>
  </header>

  <!-- Spacer يمنع تداخل الهيدر الثابت مع المحتوى -->
  <div id="header-spacer" aria-hidden="true"></div>

  <style>
    .main-header { position: relative; z-index: 1000; }

    .navbar {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.95), rgba(6, 182, 212, 0.95));
      backdrop-filter: blur(10px);
      padding: 0.75rem 0;
      transition: all 0.3s ease;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    }
    .navbar-scrolled {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.98), rgba(6, 182, 212, 0.98));
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    /* الشعار */
    .logo-container {
      position: relative;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
      border-radius: 18px;
      padding: 12px 16px;
      transition: all 0.4s ease;
      box-shadow:
        0 8px 25px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .logo-container:hover { transform: translateY(-3px) scale(1.02); }
    .logo-img { height: 60px !important; width: auto !important; transition: filter 0.3s ease; filter: brightness(1.05) contrast(1.1); }
    .logo-container:hover .logo-img { filter: brightness(1.1) contrast(1.15); }

    /* الروابط */
    .nav-link {
      color: rgba(255, 255, 255, 0.9) !important;
      font-weight: 500;
      padding: 0.75rem 1rem !important;
      border-radius: 10px;
      transition: all 0.3s ease;
      margin: 0 0.25rem;
      position: relative;
    }
    .nav-link:hover { color: #fff !important; background: rgba(255, 255, 255, 0.1); transform: translateY(-2px); }

    /* القوائم المنسدلة */
    .custom-dropdown {
      background: #fff; border: none; border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      padding: 0.5rem 0; margin-top: 0.5rem; min-width: 260px;
    }
    .dropdown-item {
      padding: 0.75rem 1.5rem; color: #2d3748; font-weight: 500; transition: all 0.2s ease;
      display: flex; align-items: center; justify-content: space-between;
    }
    .dropdown-item:hover { background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(6, 182, 212, 0.08)); color: #8b5cf6; transform: translateX(-3px); }
    .dropdown-item.disabled { color: #a0aec0; pointer-events: none; }

    .game-status-badge { font-size: 0.7rem; padding: 0.25rem 0.5rem; border-radius: 15px; font-weight: 600; }
    .game-status-badge.available { background: rgba(16, 185, 129, 0.1); color: #059669; }
    .game-status-badge.coming-soon { background: rgba(245, 158, 11, 0.1); color: #d97706; }

    /* المستخدم */
    .user-menu { display: flex; align-items: center; background: rgba(255, 255, 255, 0.1); border-radius: 25px; padding: 0.5rem 1rem !important; }
    .user-avatar {
      width: 35px; height: 35px; background: #fff; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; color: #8b5cf6; margin-left: 0.5rem;
    }
    .user-name { font-weight: 600; }
    .user-dropdown { min-width: 280px; }

    /* أزرار الدخول */
    .auth-buttons { display: flex; gap: 0.5rem; }
    .btn-outline-light {
      border: 2px solid rgba(255, 255, 255, 0.3); color: #fff; font-weight: 600;
      padding: 0.5rem 1.5rem; border-radius: 25px; transition: all 0.2s ease;
    }
    .btn-outline-light:hover { background: #fff; color: #8b5cf6; border-color: #fff; transform: translateY(-2px); }
    .btn-primary {
      background: linear-gradient(135deg, #f59e0b, #f97316); border: none; font-weight: 600;
      padding: 0.5rem 1.5rem; border-radius: 25px; transition: all 0.2s ease;
    }
    .btn-primary:hover { background: linear-gradient(135deg, #f97316, #ea580c); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(245, 158, 11, 0.35); }

    /* زر الجوال */
    .custom-toggler { border: none; padding: 0.5rem; background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
    .custom-toggler:focus { box-shadow: none; }
    .toggler-icon { display: block; width: 25px; height: 3px; background: #fff; margin: 5px 0; transition: all 0.2s ease; border-radius: 2px; }
    .custom-toggler[aria-expanded="true"] .toggler-icon:nth-child(1) { transform: rotate(45deg) translate(6px, 6px); }
    .custom-toggler[aria-expanded="true"] .toggler-icon:nth-child(2) { opacity: 0; }
    .custom-toggler[aria-expanded="true"] .toggler-icon:nth-child(3) { transform: rotate(-45deg) translate(6px, -6px); }

    /* Responsive */
    @media (max-width: 991px) {
      .navbar-collapse {
        background: rgba(255, 255, 255, 0.97);
        border-radius: 15px;
        padding: 1rem;
        margin-top: 1rem;
        backdrop-filter: blur(10px);
      }
      .nav-link { color: #2d3748 !important; margin: 0.25rem 0; }
      .nav-link:hover { background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(6, 182, 212, 0.1)); color: #8b5cf6 !important; }
      .auth-buttons { margin-top: 0.5rem; flex-direction: column; gap: 0.75rem; }
      .user-menu { background: linear-gradient(135deg, rgba(139, 92, 246, 0.08), rgba(6, 182, 212, 0.08)); color: #2d3748 !important; }
      .user-avatar { background: #8b5cf6; color: #fff; }
      .logo-img { height: 50px !important; }
      .logo-container { padding: 8px 12px; }
    }
    @media (max-width: 576px) {
      .navbar { padding: 0.5rem 0; }
      .logo-img { height: 45px !important; }
      .logo-container { padding: 6px 10px; }
    }

    /* حركة القوائم على الديسكتوب فقط */
    .dropdown-menu { opacity: 0; transform: translateY(-8px); transition: all 0.2s ease; display: block; visibility: hidden; }
    .dropdown:hover .dropdown-menu,
    .dropdown.show .dropdown-menu { opacity: 1; transform: translateY(0); visibility: visible; }
    @media (max-width: 991px) {
      .dropdown-menu { opacity: 1; transform: none; visibility: visible; }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const navbar = document.querySelector('.navbar');
      const spacer = document.getElementById('header-spacer');

      // 1) حلّ التداخل: اجعل الـ spacer يساوي ارتفاع الهيدر دائماً
      function setSpacerHeight() {
        const h = navbar.getBoundingClientRect().height;
        spacer.style.height = h + 'px';
      }
      setSpacerHeight();
      window.addEventListener('resize', setSpacerHeight);

      // 2) تغيير نمط الهيدر عند التمرير
      function onScroll() {
        if (window.scrollY > 50) {
          navbar.classList.add('navbar-scrolled');
        } else {
          navbar.classList.remove('navbar-scrolled');
        }
      }
      onScroll();
      window.addEventListener('scroll', onScroll, { passive: true });

      // 3) إبراز الرابط النشط (يدعم المسارات الفرعية)
      const currentPath = window.location.pathname.replace(/\/+$/, '') || '/';
      document.querySelectorAll('.nav-link[href]').forEach(link => {
        const href = link.getAttribute('href') || '';
        // تجاهل الروابط التي تبدأ بـ #
        if (href.startsWith('#')) return;
        const normalized = href.replace(/\/+$/, '') || '/';
        if (currentPath === normalized || (normalized !== '/' && currentPath.startsWith(normalized))) {
          link.classList.add('active');
          link.style.background = 'rgba(255, 255, 255, 0.2)';
        }
      });

      // 4) جعل القوائم المنسدلة تعمل بالهوفر على الديسكتوب فقط
      const dropdowns = document.querySelectorAll('.dropdown');
      dropdowns.forEach(dd => {
        dd.addEventListener('mouseenter', () => {
          if (window.innerWidth > 991) {
            dd.classList.add('show');
            dd.querySelector('.dropdown-menu')?.classList.add('show');
          }
        });
        dd.addEventListener('mouseleave', () => {
          if (window.innerWidth > 991) {
            dd.classList.remove('show');
            dd.querySelector('.dropdown-menu')?.classList.remove('show');
          }
        });
      });

      // 5) عند فتح/غلق التوجل في الجوال، أعِد حساب ارتفاع الـ spacer
      const toggler = document.querySelector('.navbar-toggler');
      const navCollapse = document.getElementById('navbarNav');
      if (toggler && navCollapse) {
        navCollapse.addEventListener('shown.bs.collapse', setSpacerHeight);
        navCollapse.addEventListener('hidden.bs.collapse', setSpacerHeight);
      }
    });
  </script>
</body>
</html>
