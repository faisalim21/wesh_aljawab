<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- تثبيت الثيم الفاتح -->
  <meta name="color-scheme" content="light">
  <meta name="theme-color" content="#6d28d9">

  <!-- Bootstrap & Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    :root{
      --primary-start:#8b5cf6; --primary-end:#06b6d4;
      --brand-bg:#ffffff; --brand-bg-soft:#f8fafc;
      --text:#1f2937; --text-strong:#0f172a; --muted:#64748b;
      --success-bg:rgba(16,185,129,.1); --success-tx:#059669;
      --warn-bg:rgba(245,158,11,.1); --warn-tx:#d97706;
      --navbar-grad:linear-gradient(135deg, rgba(139,92,246,.95), rgba(6,182,212,.95));
      --navbar-grad-scrolled:linear-gradient(135deg, rgba(139,92,246,.98), rgba(6,182,212,.98));
      --btn-grad:linear-gradient(135deg,#f59e0b,#f97316);
      --btn-grad-hover:linear-gradient(135deg,#f97316,#ea580c);
      --radius:16px; --transition:.3s cubic-bezier(.25,.8,.25,1);
    }

    html,body{ background:var(--brand-bg); color:var(--text); }

    .navbar{
      background:var(--navbar-grad);
      backdrop-filter:blur(10px);
      padding:.75rem 0;
      transition:var(--transition);
      box-shadow:0 2px 20px rgba(0,0,0,.10);
    }
    .navbar.navbar-scrolled{
      background:var(--navbar-grad-scrolled);
      box-shadow:0 4px 20px rgba(0,0,0,.15);
      padding:.5rem 0;
    }

    .logo-container{
      background:linear-gradient(145deg, rgba(255,255,255,.95), rgba(255,255,255,.85));
      border-radius:var(--radius);
      padding:10px 14px;
      transition:var(--transition);
      box-shadow:0 8px 25px rgba(0,0,0,.15), inset 0 1px 0 rgba(255,255,255,.8);
      border:1px solid rgba(255,255,255,.3);
    }
    .logo-container:hover{ transform:translateY(-3px) scale(1.02); }
    .logo-img{ height:58px; width:auto; }

    .nav-link{
      color:rgba(255,255,255,.95)!important; font-weight:500;
      padding:.7rem .9rem!important; border-radius:10px;
      transition:var(--transition); margin:0 .2rem;
      position:relative;
    }
    .nav-link:hover{ color:#fff!important; background:rgba(255,255,255,.12); transform:translateY(-2px); }
    .nav-link.active{ background:rgba(255,255,255,.2); color:#fff!important; }
    .dropdown-toggle::after{ border-top-color: currentColor; }

    .custom-dropdown{ border:none; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.12); padding:.35rem 0; min-width:260px; }
    .dropdown-item{ padding:.7rem 1rem; font-weight:500; }
    .dropdown-item:hover{ background:linear-gradient(135deg, rgba(139,92,246,.08), rgba(6,182,212,.08)); color:#8b5cf6; }

    .game-status-badge{ font-size:.7rem; padding:.25rem .55rem; border-radius:14px; font-weight:700; }
    .available{ background:var(--success-bg); color:var(--success-tx); }
    .coming-soon{ background:var(--warn-bg); color:var(--warn-tx); }

    .user-menu{
      display:flex; align-items:center;
      background:rgba(255,255,255,.12); border-radius:25px; padding:.4rem .9rem!important; gap:.5rem;
    }
    .user-menu:hover{ background:rgba(255,255,255,.18); }
    .user-avatar{ width:34px; height:34px; background:#fff; color:#8b5cf6; border-radius:50%; display:flex; align-items:center; justify-content:center; }

    .btn-outline-light{
      border:2px solid rgba(255,255,255,.35); color:#fff; font-weight:600; padding:.45rem 1.25rem; border-radius:25px; transition:var(--transition);
    }
    .btn-outline-light:hover{ background:#fff; color:#8b5cf6; border-color:#fff; transform:translateY(-2px); box-shadow:0 5px 15px rgba(255,255,255,.25); }

    .btn-primary{
      background:var(--btn-grad); border:none; font-weight:700; padding:.5rem 1.25rem; border-radius:25px; color:#fff; transition:var(--transition);
    }
    .btn-primary:hover{ background:var(--btn-grad-hover); transform:translateY(-2px); box-shadow:0 5px 15px rgba(245,158,11,.35); }

    /* زر الـ Hamburger مع أنميشن التحول إلى X */
    .custom-toggler{
      border:none; width:44px; height:44px; background:rgba(255,255,255,.12);
      border-radius:10px; display:flex; flex-direction:column; justify-content:center; align-items:center;
      gap:6px; padding:0; transition:var(--transition);
    }
    .custom-toggler .toggler-icon{
      width:26px; height:3px; background:#fff; border-radius:2px; display:block;
      transition:transform .25s ease, opacity .25s ease;
    }
    .navbar-toggler[aria-expanded="true"] .toggler-icon:nth-child(1){
      transform: translateY(9px) rotate(45deg);
    }
    .navbar-toggler[aria-expanded="true"] .toggler-icon:nth-child(2){
      opacity:0;
    }
    .navbar-toggler[aria-expanded="true"] .toggler-icon:nth-child(3){
      transform: translateY(-9px) rotate(-45deg);
    }

    /* موبایل */
    @media (max-width: 991.98px){
      .navbar-collapse{
        background:rgba(255,255,255,.97);
        border-radius:14px; padding:1rem; margin-top:.75rem;
        box-shadow:0 10px 25px rgba(0,0,0,.1);
      }
      .nav-link{ color:#2d3748!important; }
      .nav-link.active{ background:linear-gradient(135deg, rgba(139,92,246,.12), rgba(6,182,212,.12)); color:#8b5cf6!important; }
      .user-menu{ background:linear-gradient(135deg, rgba(139,92,246,.08), rgba(6,182,212,.08)); color:#2d3748!important; }
      /* إبقاء نص الأزرار ظاهر عند فتح القوائم المنسدلة */
      .dropdown .nav-link.dropdown-toggle[aria-expanded="true"]{
        color:#8b5cf6!important;
        background:linear-gradient(135deg, rgba(139,92,246,.12), rgba(6,182,212,.12));
      }
    }
  </style>
</head>
<body>

<header class="main-header" role="banner">
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top" aria-label="الشريط العلوي">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-brand d-flex align-items-center" href="{% url 'home' %}" aria-label="الرئيسية - وش الجواب">
        <div class="logo-container">
          <img src="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png" alt="وش الجواب" class="logo-img" width="160" height="60" loading="eager" decoding="async"/>
        </div>
      </a>

      <!-- Toggler -->
      <button class="navbar-toggler custom-toggler" type="button"
              data-bs-toggle="collapse" data-bs-target="#navbarNav"
              aria-controls="navbarNav" aria-expanded="false" aria-label="تبديل القائمة">
        <span class="toggler-icon"></span>
        <span class="toggler-icon"></span>
        <span class="toggler-icon"></span>
      </button>

      <!-- Menu -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto" role="menubar">
          <li class="nav-item" role="none">
            <a class="nav-link" href="{% url 'home' %}" role="menuitem">
              <i class="fas fa-home me-1" aria-hidden="true"></i>
              الرئيسية
            </a>
          </li>

          <li class="nav-item dropdown" role="none">
            <a class="nav-link dropdown-toggle" href="#" role="button"
               data-bs-toggle="dropdown" aria-expanded="false" id="gamesDropdown">
              <i class="fas fa-gamepad me-1" aria-hidden="true"></i>
              الألعاب
            </a>
            <ul class="dropdown-menu custom-dropdown" role="menu" aria-labelledby="gamesDropdown">
              <li role="none">
                <a class="dropdown-item d-flex justify-content-between align-items-center" href="{% url 'games:letters_home' %}" role="menuitem">
                  <span><i class="fas fa-font me-2"></i> خلية الحروف</span>
                  <span class="game-status-badge available">متاح</span>
                </a>
              </li>
              <li role="none">
                <a class="dropdown-item d-flex justify-content-between align-items-center" href="{% url 'games:images_home' %}" role="menuitem">
                  <span><i class="fas fa-images me-2"></i> تحدي الصور</span>
                  <span class="game-status-badge available">متاح</span>
                </a>
              </li>
              <li role="none">
                <a class="dropdown-item d-flex justify-content-between align-items-center disabled" href="#" role="menuitem" aria-disabled="true" tabindex="-1">
                  <span><i class="fas fa-question-circle me-2"></i> سؤال وجواب</span>
                  <span class="game-status-badge coming-soon">قريباً</span>
                </a>
              </li>
            </ul>
          </li>

          <li class="nav-item" role="none">
            <a class="nav-link" href="#about" role="menuitem">
              <i class="fas fa-info-circle me-1" aria-hidden="true"></i>
              حول المنصة
            </a>
          </li>
          <li class="nav-item" role="none">
            <a class="nav-link" href="#contact" role="menuitem">
              <i class="fas fa-envelope me-1" aria-hidden="true"></i>
              تواصل معنا
            </a>
          </li>
        </ul>

        <!-- User Actions -->
        <div class="navbar-nav ms-auto">
          {% if user.is_authenticated %}
          <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle user-menu" href="#" role="button"
               data-bs-toggle="dropdown" aria-expanded="false" id="userDropdown">
              <div class="user-avatar" aria-hidden="true">
                <i class="fas fa-user"></i>
              </div>
              <span class="user-name">{{ user.profile.display_name|default:user.username }}</span>
            </a>
            <ul class="dropdown-menu custom-dropdown user-dropdown" role="menu" aria-labelledby="userDropdown">
              <li class="px-3 py-2">
                <small class="text-muted d-block">{{ user.email }}</small>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <!-- مُبقي فقط: مشترياتي + خروج -->
              <li role="none">
                <a class="dropdown-item" href="{% url 'payments:history' %}" role="menuitem">
                  <i class="fas fa-credit-card me-2" aria-hidden="true"></i>
                  مشترياتي
                </a>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li role="none">
                <a class="dropdown-item text-danger" href="{% url 'accounts:logout' %}" role="menuitem">
                  <i class="fas fa-sign-out-alt me-2" aria-hidden="true"></i>
                  تسجيل الخروج
                </a>
              </li>
            </ul>
          </div>
          {% else %}
          <div class="auth-buttons d-flex align-items-center gap-2">
            <a href="{% url 'accounts:login' %}" class="btn btn-outline-light">
              <i class="fas fa-sign-in-alt me-1" aria-hidden="true"></i>
              دخول
            </a>
            <a href="{% url 'accounts:register' %}" class="btn btn-primary">
              <i class="fas fa-user-plus me-1" aria-hidden="true"></i>
              تسجيل جديد
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </nav>
</header>

<!-- Spacer لمنع تداخل الهيدر الثابت مع المحتوى -->
<div id="header-spacer" aria-hidden="true"></div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
(function(){
  const navbar = document.querySelector('.navbar');
  const spacer = document.getElementById('header-spacer');
  const navCollapse = document.getElementById('navbarNav');

  // 1) ضبط ارتفاع الـ spacer دائمًا
  function setSpacerHeight(){ spacer.style.height = navbar.getBoundingClientRect().height + 'px'; }
  setSpacerHeight();
  if ('ResizeObserver' in window){
    new ResizeObserver(setSpacerHeight).observe(navbar);
  } else {
    window.addEventListener('resize', setSpacerHeight);
  }

  // 2) تأثير التمرير
  function onScroll(){ (window.scrollY > 50) ? navbar.classList.add('navbar-scrolled') : navbar.classList.remove('navbar-scrolled'); }
  onScroll();
  window.addEventListener('scroll', onScroll, { passive:true });

  // 3) إبراز الرابط النشط
  const currentPath = (window.location.pathname.replace(/\/+$/, '') || '/');
  document.querySelectorAll('.nav-link[href]').forEach(link => {
    const href = link.getAttribute('href') || '';
    if (href.startsWith('#')) return;
    const normalized = (href.replace(/\/+$/, '') || '/');
    if (currentPath === normalized || (normalized !== '/' && currentPath.startsWith(normalized))){
      link.classList.add('active');
    }
  });

  // 4) إغلاق قائمة الجوال عند الضغط على رابط فعلي فقط (ليس dropdown-toggle)
  document.querySelectorAll('#navbarNav a.nav-link:not(.dropdown-toggle), #navbarNav .dropdown-item:not(.disabled)').forEach(a=>{
    a.addEventListener('click', () => {
      if (window.innerWidth <= 991 && navCollapse?.classList.contains('show')){
        bootstrap.Collapse.getOrCreateInstance(navCollapse).hide();
      }
    });
  });

  // 5) Hover للديسكتوب فقط
  const dropdowns = document.querySelectorAll('.nav-item.dropdown');
  const desktopHover = () => window.matchMedia('(pointer:fine)').matches && window.innerWidth > 991;
  function onEnter(){ if (desktopHover()){ this.classList.add('show'); this.querySelector('.dropdown-toggle')?.setAttribute('aria-expanded','true'); this.querySelector('.dropdown-menu')?.classList.add('show'); } }
  function onLeave(){ if (desktopHover()){ this.classList.remove('show'); this.querySelector('.dropdown-toggle')?.setAttribute('aria-expanded','false'); this.querySelector('.dropdown-menu')?.classList.remove('show'); } }
  function bindHover(){ dropdowns.forEach(dd=>{ dd.addEventListener('mouseenter', onEnter); dd.addEventListener('mouseleave', onLeave); }); }
  function unbindHover(){ dropdowns.forEach(dd=>{ dd.removeEventListener('mouseenter', onEnter); dd.removeEventListener('mouseleave', onLeave); }); }
  function refreshHover(){ unbindHover(); if (desktopHover()) bindHover(); }
  refreshHover(); window.addEventListener('resize', refreshHover);

  // 6) اترك Bootstrap يدير فتح/غلق dropdown بالنقر على الجوال (لا stopPropagation ولا toggle يدوي)
})();
</script>

</body>
</html>
