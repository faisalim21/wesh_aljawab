<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="color-scheme" content="light">
  <meta name="theme-color" content="#6366f1">

  <!-- Bootstrap & Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

  <style>
    :root{
      --primary-start:#6366f1; 
      --primary-mid:#8b5cf6; 
      --primary-end:#06b6d4;
      --brand-bg:#ffffff; 
      --text:#1f2937;
      --navbar-grad:linear-gradient(135deg, rgba(99,102,241,.95) 0%, rgba(139,92,246,.94) 50%, rgba(6,182,212,.95) 100%);
      --navbar-grad-scrolled:linear-gradient(135deg, rgba(99,102,241,.98) 0%, rgba(139,92,246,.97) 50%, rgba(6,182,212,.98) 100%);
      --radius:20px; 
      --radius-sm:14px;
      --transition:.35s cubic-bezier(.25,.8,.25,1);
      --shadow-sm:0 4px 12px rgba(0,0,0,.08);
      --shadow-md:0 8px 24px rgba(99,102,241,.15);
    }

    html,body{ background:var(--brand-bg); color:var(--text); scroll-behavior:smooth; }

    /* ===== NAVBAR ===== */
    .navbar{
      background:var(--navbar-grad);
      backdrop-filter:blur(20px);
      padding:1rem 0;
      transition:var(--transition);
      box-shadow:var(--shadow-sm);
      position:relative;
      overflow:hidden;
    }

    .navbar::before{
      content:'';
      position:absolute;
      top:0; left:0; right:0; bottom:0;
      background:radial-gradient(circle at 25% 40%, rgba(255,255,255,.12) 0%, transparent 55%),
                 radial-gradient(circle at 75% 60%, rgba(255,255,255,.08) 0%, transparent 55%);
      pointer-events:none;
      opacity:0;
      transition:opacity .5s ease;
    }

    .navbar:hover::before{ opacity:1; }

    .navbar.navbar-scrolled{
      background:var(--navbar-grad-scrolled);
      box-shadow:var(--shadow-md);
      padding:.65rem 0;
    }

    /* ===== LOGO ===== */
    .logo-container{
      background:linear-gradient(145deg, rgba(255,255,255,.98), rgba(255,255,255,.92));
      border-radius:var(--radius);
      padding:12px 16px;
      transition:var(--transition);
      box-shadow:0 8px 28px rgba(99,102,241,.18), 
                 inset 0 1px 0 rgba(255,255,255,.9),
                 inset 0 -1px 0 rgba(0,0,0,.03);
      border:1px solid rgba(255,255,255,.4);
      position:relative;
      overflow:hidden;
    }

    .logo-container::before{
      content:'';
      position:absolute;
      top:-50%; left:-50%;
      width:200%; height:200%;
      background:linear-gradient(45deg, transparent 30%, rgba(255,255,255,.3) 50%, transparent 70%);
      transform:rotate(45deg);
      opacity:0;
      transition:opacity .6s ease;
    }

    .logo-container:hover::before{ 
      opacity:1;
      animation:shine 1.2s ease-in-out;
    }

    @keyframes shine{
      0%{ transform:rotate(45deg) translateX(-100%); }
      100%{ transform:rotate(45deg) translateX(100%); }
    }

    .logo-container:hover{ 
      transform:translateY(-4px) scale(1.03);
      box-shadow:0 12px 36px rgba(99,102,241,.25);
    }

    .logo-img{ 
      height:60px; 
      width:auto;
      display:block;
      position:relative;
      z-index:1;
    }

    /* ===== NAV LINKS ===== */
    .nav-link{
      color:rgba(255,255,255,.96)!important; 
      font-weight:600;
      padding:.8rem 1.1rem!important; 
      border-radius:var(--radius-sm);
      transition:var(--transition); 
      margin:0 .3rem;
      position:relative;
      overflow:hidden;
      font-size:.98rem;
    }

    .nav-link::before{
      content:'';
      position:absolute;
      top:0; left:0; right:0; bottom:0;
      background:rgba(255,255,255,.15);
      border-radius:var(--radius-sm);
      transform:scale(0);
      transition:transform .4s cubic-bezier(.68,-.55,.27,1.55);
    }

    .nav-link:hover::before{ transform:scale(1); }

    .nav-link:hover{ 
      color:#fff!important;
      transform:translateY(-2px);
    }

    .nav-link.active{ 
      background:rgba(255,255,255,.22);
      color:#fff!important;
      box-shadow:0 4px 12px rgba(255,255,255,.15);
    }

    .nav-link i{ 
      margin-left:.4rem;
      transition:transform .3s ease;
    }

    .nav-link:hover i{ transform:scale(1.15); }

    /* ===== DROPDOWN ===== */
    .custom-dropdown{ 
      border:none; 
      border-radius:var(--radius); 
      box-shadow:0 12px 40px rgba(0,0,0,.15); 
      padding:.5rem 0; 
      min-width:280px;
      backdrop-filter:blur(20px);
      background:rgba(255,255,255,.98);
    }

    .dropdown-item{ 
      padding:.85rem 1.2rem; 
      font-weight:600;
      transition:var(--transition);
      border-radius:8px;
      margin:.15rem .5rem;
    }

    .dropdown-item:hover{ 
      background:linear-gradient(135deg, rgba(99,102,241,.1), rgba(6,182,212,.08));
      color:#6366f1;
      transform:translateX(-4px);
    }

    .dropdown-item i{
      width:24px;
      text-align:center;
    }

    /* ===== GAME STATUS BADGES ===== */
    .game-status-badge{ 
      font-size:.72rem; 
      padding:.35rem .7rem; 
      border-radius:20px; 
      font-weight:800;
      letter-spacing:.3px;
      border:1.5px solid;
    }

    .available{ 
      background:rgba(16,185,129,.12); 
      color:#059669;
      border-color:rgba(16,185,129,.3);
    }

    .coming-soon{ 
      background:rgba(245,158,11,.12); 
      color:#d97706;
      border-color:rgba(245,158,11,.3);
    }

    /* ===== USER MENU ===== */
    .user-menu{
      display:flex !important; 
      align-items:center !important; 
      flex-direction:row !important;
      gap:.7rem !important;
      background:rgba(255,255,255,.15); 
      border-radius:30px; 
      padding:.5rem 1.1rem!important;
      white-space:nowrap;
      border:1px solid rgba(255,255,255,.2);
      transition:var(--transition);
    }

    .user-menu:hover{
      background:rgba(255,255,255,.22);
      border-color:rgba(255,255,255,.35);
      transform:translateY(-2px);
    }

    .user-menu .user-avatar{
      width:38px; 
      height:38px; 
      background:linear-gradient(135deg, #fff, #f8f9fa); 
      color:#6366f1; 
      border-radius:50%;
      display:flex; 
      align-items:center; 
      justify-content:center; 
      flex-shrink:0;
      font-size:1.1rem;
      box-shadow:0 2px 8px rgba(0,0,0,.1);
    }

    .user-menu .user-name{
      overflow:hidden; 
      text-overflow:ellipsis; 
      max-width:14ch;
      line-height:1.3;
      flex-shrink:1;
      font-weight:600;
    }

    .user-menu.dropdown-toggle::after{ 
      margin-inline-start:.45rem;
      transition:transform .3s ease;
    }

    .user-menu.dropdown-toggle[aria-expanded="true"]::after{
      transform:rotate(180deg);
    }

    /* ===== AUTH BUTTONS ===== */
    .btn-outline-light{
      border:2px solid rgba(255,255,255,.4); 
      color:#fff; 
      font-weight:700; 
      padding:.55rem 1.4rem; 
      border-radius:30px; 
      transition:var(--transition);
      position:relative;
      overflow:hidden;
    }

    .btn-outline-light::before{
      content:'';
      position:absolute;
      top:50%; left:50%;
      width:0; height:0;
      background:#fff;
      border-radius:50%;
      transform:translate(-50%, -50%);
      transition:width .5s ease, height .5s ease;
    }

    .btn-outline-light:hover::before{
      width:300px; height:300px;
    }

    .btn-outline-light:hover{ 
      background:transparent;
      color:#6366f1; 
      border-color:#fff;
      transform:translateY(-3px);
      box-shadow:0 6px 20px rgba(255,255,255,.3);
    }

    .btn-outline-light span{
      position:relative;
      z-index:1;
    }

    .btn-primary{
      background:linear-gradient(135deg, #f59e0b 0%, #f97316 100%); 
      border:none; 
      font-weight:800; 
      padding:.55rem 1.4rem; 
      border-radius:30px; 
      color:#fff; 
      transition:var(--transition);
      box-shadow:0 4px 15px rgba(245,158,11,.25);
    }

    .btn-primary:hover{ 
      background:linear-gradient(135deg, #f97316 0%, #ea580c 100%);
      transform:translateY(-3px);
      box-shadow:0 8px 25px rgba(245,158,11,.4);
    }

    /* ===== TOGGLER ===== */
    .custom-toggler{
      border:none !important; 
      width:48px; 
      height:48px; 
      background:rgba(255,255,255,.15) !important;
      border-radius:var(--radius-sm); 
      display:flex; 
      flex-direction:column; 
      justify-content:center; 
      align-items:center;
      cursor:pointer; 
      transition:var(--transition); 
      position:relative; 
      z-index:1051;
      padding:0 !important;
      box-shadow:0 2px 8px rgba(0,0,0,.1);
    }

    .custom-toggler:hover{ 
      background:rgba(255,255,255,.25) !important;
      transform:scale(1.08);
    }

    .custom-toggler:focus{ box-shadow:none !important; }
    
    .toggler-icon{
      width:26px; 
      height:3px; 
      background:#fff; 
      border-radius:3px; 
      display:block;
      transition:all .35s cubic-bezier(.68,-.55,.27,1.55);
      margin:3px 0;
      position:relative;
    }
    
    .custom-toggler[aria-expanded="true"] .toggler-icon:nth-child(1){ 
      transform:rotate(45deg) translate(7px, 7px); 
    }

    .custom-toggler[aria-expanded="true"] .toggler-icon:nth-child(2){ 
      opacity:0;
      transform:scale(0);
    }

    .custom-toggler[aria-expanded="true"] .toggler-icon:nth-child(3){ 
      transform:rotate(-45deg) translate(7px, -7px); 
    }

    /* ===== MOBILE MENU ===== */
    @media (max-width: 991.98px){
      .navbar-collapse{
        background:rgba(255,255,255,.98);
        backdrop-filter:blur(30px);
        border-radius:var(--radius); 
        padding:0; 
        margin-top:1rem;
        box-shadow:0 12px 40px rgba(0,0,0,.12);
        border:1px solid rgba(99,102,241,.1);
        max-height:0;
        opacity:0;
        transform:translateY(-40px) scale(0.92);
        transition:all 0.65s cubic-bezier(0.16, 1, 0.3, 1);
        overflow:hidden;
      }

      .navbar-collapse.show{
        max-height:700px;
        opacity:1;
        transform:translateY(0) scale(1);
        padding:1.2rem;
      }
      
      .navbar-collapse .nav-item{
        opacity:0;
        transform:translateY(-20px);
        transition:all 0.45s cubic-bezier(0.16, 1, 0.3, 1);
      }

      .navbar-collapse.show .nav-item{
        opacity:1;
        transform:translateY(0);
      }

      .navbar-collapse.show .nav-item:nth-child(1){ transition-delay:.08s; }
      .navbar-collapse.show .nav-item:nth-child(2){ transition-delay:.14s; }
      .navbar-collapse.show .nav-item:nth-child(3){ transition-delay:.2s; }
      .navbar-collapse.show .navbar-nav:last-child{ transition-delay:.26s; }
      
      .nav-link{ 
        color:#2d3748!important;
        margin:.25rem 0;
      }

      .nav-link:hover{ 
        background:linear-gradient(135deg, rgba(99,102,241,.1), rgba(6,182,212,.08));
        color:#6366f1!important;
      }

      .nav-link.active{ 
        background:linear-gradient(135deg, rgba(99,102,241,.15), rgba(6,182,212,.12));
        color:#6366f1!important;
      }

      .user-menu{ 
        background:linear-gradient(135deg, rgba(99,102,241,.1), rgba(6,182,212,.08));
        color:#2d3748!important;
        border-radius:var(--radius-sm);
        border-color:rgba(99,102,241,.2);
      }

      .user-menu .user-name{ max-width:20ch; }
      
      /* Dropdown في الجوال */
      .dropdown-menu{
        position:static!important; 
        transform:none!important;
        box-shadow:none!important; 
        border:none!important; 
        background:transparent!important;
        margin:.6rem 0 0 0!important; 
        padding:0!important;
        max-height:0;
        overflow:hidden;
        opacity:0;
        transform:translateY(-15px) scale(0.96);
        transition:all 0.55s cubic-bezier(0.16, 1, 0.3, 1);
      }

      .dropdown-menu.show{
        display:block!important;
        max-height:400px;
        opacity:1;
        transform:translateY(0) scale(1);
      }
      
      .dropdown-item{
        background:rgba(99,102,241,.06)!important; 
        margin:.3rem 0; 
        border-radius:10px; 
        color:#2d3748!important;
        opacity:0;
        transform:translateX(25px);
        transition:all 0.35s cubic-bezier(0.16, 1, 0.3, 1);
      }

      .dropdown-menu.show .dropdown-item{
        opacity:1;
        transform:translateX(0);
      }

      .dropdown-menu.show .dropdown-item:nth-child(1){ transition-delay:.08s; }
      .dropdown-menu.show .dropdown-item:nth-child(2){ transition-delay:.14s; }
      .dropdown-menu.show .dropdown-item:nth-child(3){ transition-delay:.2s; }
      .dropdown-menu.show .dropdown-item:nth-child(4){ transition-delay:.26s; }
      .dropdown-menu.show .dropdown-item:nth-child(5){ transition-delay:.32s; }

      .dropdown-item:hover{
        background:linear-gradient(135deg, rgba(99,102,241,.14), rgba(6,182,212,.1))!important;
      }
    }

    /* ===== SPACER ===== */
    #header-spacer{ width:100%; }

    /* ===== SMOOTH SCROLL ===== */
    html{ scroll-behavior:smooth; }
  </style>
</head>
<body>

<header class="main-header" role="banner">
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top" aria-label="الشريط العلوي">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-brand d-flex align-items-center" href="{% url 'home' %}" aria-label="الرئيسية - وش الجواب">
        <div class="logo-container">
          <img src="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png" 
               alt="وش الجواب" 
               class="logo-img" 
               width="160" 
               height="60" 
               loading="eager" 
               decoding="async"/>
        </div>
      </a>

      <!-- Toggler -->
      <button class="navbar-toggler custom-toggler" 
              type="button"
              aria-controls="navbarNav" 
              aria-expanded="false" 
              aria-label="تبديل القائمة"
              id="navToggler">
        <span class="toggler-icon"></span>
        <span class="toggler-icon"></span>
        <span class="toggler-icon"></span>
      </button>

      <!-- Menu -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto" role="menubar">
          <!-- الرئيسية -->
          <li class="nav-item" role="none">
            <a class="nav-link" href="{% url 'home' %}" role="menuitem">
              <i class="fas fa-home" aria-hidden="true"></i>
              الرئيسية
            </a>
          </li>

          <!-- الألعاب -->
          <li class="nav-item dropdown" role="none">
            <a class="nav-link dropdown-toggle" 
               href="#" 
               role="button"
               data-bs-toggle="dropdown" 
               aria-expanded="false" 
               id="gamesDropdown">
              <i class="fas fa-gamepad" aria-hidden="true"></i>
              الألعاب
            </a>
            <ul class="dropdown-menu custom-dropdown" role="menu" aria-labelledby="gamesDropdown">
              <!-- 1. خلية الحروف -->
              <li role="none">
                <a class="dropdown-item d-flex justify-content-between align-items-center" 
                   href="{% url 'games:letters_home' %}" 
                   role="menuitem">
                  <span>
                    <i class="fas fa-font"></i> 
                    خلية الحروف
                  </span>
                  <span class="game-status-badge available">متاح</span>
                </a>
              </li>

              <!-- 2. تحدي الصور -->
              <li role="none">
                <a class="dropdown-item d-flex justify-content-between align-items-center" 
                   href="{% url 'games:images_home' %}" 
                   role="menuitem">
                  <span>
                    <i class="fas fa-images"></i> 
                    تحدي الصور
                  </span>
                  <span class="game-status-badge available">متاح</span>
                </a>
              </li>

              <!-- 3. امبوستر -->
              <li role="none">
                <a class="dropdown-item d-flex justify-content-between align-items-center" 
                   href="{% url 'games:imposter_packages' %}" 
                   role="menuitem">
                  <span>
                    <i class="fas fa-mask"></i> 
                    امبوستر
                  </span>
                  <span class="game-status-badge available">متاح</span>
                </a>
              </li>

              <!-- 4. تحدي الوقت -->
              <li role="none">
                <a class="dropdown-item d-flex justify-content-between align-items-center disabled" 
                   href="#" 
                   role="menuitem" 
                   aria-disabled="true" 
                   tabindex="-1">
                  <span>
                    <i class="fas fa-clock"></i> 
                    تحدّي الوقت
                  </span>
                  <span class="game-status-badge coming-soon">قريباً</span>
                </a>
              </li>

              <!-- 5. سؤال وجواب -->
              <li role="none">
                <a class="dropdown-item d-flex justify-content-between align-items-center disabled" 
                   href="#" 
                   role="menuitem" 
                   aria-disabled="true" 
                   tabindex="-1">
                  <span>
                    <i class="fas fa-question-circle"></i> 
                    سؤال وجواب
                  </span>
                  <span class="game-status-badge coming-soon">قريباً</span>
                </a>
              </li>
            </ul>
          </li>

          <!-- تواصل معنا -->
          <li class="nav-item" role="none">
            <a class="nav-link" href="#footer-contact" role="menuitem">
              <i class="fas fa-envelope" aria-hidden="true"></i>
              تواصل معنا
            </a>
          </li>
        </ul>

        <!-- User Actions -->
        <div class="navbar-nav ms-auto">
          {% if user.is_authenticated %}
          <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle user-menu" 
               href="#" 
               role="button"
               data-bs-toggle="dropdown" 
               aria-expanded="false" 
               id="userDropdown">
              <div class="user-avatar" aria-hidden="true">
                <i class="fas fa-user"></i>
              </div>
              <span class="user-name">{{ user.profile.display_name|default:user.username }}</span>
            </a>
            <ul class="dropdown-menu custom-dropdown user-dropdown" role="menu" aria-labelledby="userDropdown">
              <li class="px-3 py-2">
                <small class="text-muted d-block">{{ user.email }}</small>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li role="none">
                <a class="dropdown-item text-danger" href="{% url 'accounts:logout' %}" role="menuitem">
                  <i class="fas fa-sign-out-alt"></i> 
                  تسجيل الخروج
                </a>
              </li>
            </ul>
          </div>
          {% else %}
          <div class="auth-buttons d-flex align-items-center gap-2">
            <a href="{% url 'accounts:login' %}" class="btn btn-outline-light">
              <span>
                <i class="fas fa-sign-in-alt" aria-hidden="true"></i> 
                دخول
              </span>
            </a>
            <a href="{% url 'accounts:register' %}" class="btn btn-primary">
              <i class="fas fa-user-plus" aria-hidden="true"></i> 
              تسجيل جديد
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </nav>
</header>

<!-- Spacer -->
<div id="header-spacer" aria-hidden="true"></div>

<!-- Bootstrap JS -->
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
(function(){
  'use strict';

  const navbar = document.querySelector('.navbar');
  const spacer = document.getElementById('header-spacer');
  const navCollapse = document.getElementById('navbarNav');
  const toggler = document.getElementById('navToggler');

  // ===== Spacer Height =====
  function setSpacerHeight(){
    if(spacer && navbar){ 
      spacer.style.height = navbar.getBoundingClientRect().height + 'px'; 
    }
  }
  setSpacerHeight();
  
  if('ResizeObserver' in window && navbar){
    new ResizeObserver(setSpacerHeight).observe(navbar);
  } else {
    window.addEventListener('resize', setSpacerHeight, { passive:true });
  }

  // ===== Scroll Effect =====
  function onScroll(){
    if(!navbar) return;
    (window.scrollY > 50) 
      ? navbar.classList.add('navbar-scrolled') 
      : navbar.classList.remove('navbar-scrolled');
  }
  onScroll(); 
  window.addEventListener('scroll', onScroll, { passive:true });

  // ===== Active Link =====
  (function highlightActive(){
    const currentPath = (window.location.pathname.replace(/\/+$/, '') || '/');
    document.querySelectorAll('.nav-link[href]').forEach(link=>{
      const href = link.getAttribute('href') || '';
      if(href.startsWith('#')) return;
      const normalized = (href.replace(/\/+$/, '') || '/');
      if(currentPath === normalized || (normalized !== '/' && currentPath.startsWith(normalized))){
        link.classList.add('active');
      }
    });
  })();

  // ===== Toggler =====
  if(toggler && navCollapse){
    toggler.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const isExpanded = toggler.getAttribute('aria-expanded') === 'true';
      
      if(isExpanded) {
        navCollapse.classList.remove('show');
        toggler.setAttribute('aria-expanded', 'false');
      } else {
        navCollapse.classList.add('show');
        toggler.setAttribute('aria-expanded', 'true');
      }
    });

    // Close on outside click
    document.addEventListener('click', function(e) {
      if(window.innerWidth <= 991) {
        const isClickInsideNav = navCollapse.contains(e.target);
        const isClickOnToggler = toggler.contains(e.target);
        
        if(!isClickInsideNav && !isClickOnToggler && navCollapse.classList.contains('show')) {
          navCollapse.classList.remove('show');
          toggler.setAttribute('aria-expanded', 'false');
        }
      }
    });

    // Close on resize to desktop
    window.addEventListener('resize', function(){
      if(window.innerWidth > 991 && navCollapse.classList.contains('show')) {
        navCollapse.classList.remove('show');
        toggler.setAttribute('aria-expanded', 'false');
      }
    }, { passive:true });
  }

  // ===== Close menu on link click (mobile) =====
  document.querySelectorAll('#navbarNav a.nav-link:not(.dropdown-toggle), #navbarNav .dropdown-item:not(.disabled)').forEach(link=>{
    link.addEventListener('click', function(){
      if(window.innerWidth <= 991 && navCollapse?.classList.contains('show')){
        navCollapse.classList.remove('show');
        toggler.setAttribute('aria-expanded', 'false');
      }
    });
  });

  // ===== Desktop Hover =====
  const dropdowns = document.querySelectorAll('.nav-item.dropdown');
  const isDesktop = () => window.matchMedia('(pointer:fine)').matches && window.innerWidth > 991;

  function onEnter(){
    if(!isDesktop()) return;
    this.classList.add('show');
    this.querySelector('.dropdown-toggle')?.setAttribute('aria-expanded','true');
    this.querySelector('.dropdown-menu')?.classList.add('show');
  }

  function onLeave(){
    if(!isDesktop()) return;
    this.classList.remove('show');
    this.querySelector('.dropdown-toggle')?.setAttribute('aria-expanded','false');
    this.querySelector('.dropdown-menu')?.classList.remove('show');
  }

  function bindDesktopHover(){ 
    dropdowns.forEach(dd=>{ 
      dd.addEventListener('mouseenter', onEnter); 
      dd.addEventListener('mouseleave', onLeave); 
    }); 
  }

  function unbindDesktopHover(){ 
    dropdowns.forEach(dd=>{ 
      dd.removeEventListener('mouseenter', onEnter); 
      dd.removeEventListener('mouseleave', onLeave); 
    }); 
  }

  function refreshHover(){ 
    unbindDesktopHover(); 
    if(isDesktop()) bindDesktopHover(); 
  }

  refreshHover(); 
  window.addEventListener('resize', refreshHover, { passive:true });

  // ===== Mobile Dropdown Toggle =====
  document.querySelectorAll('.dropdown-toggle').forEach(toggle=>{
    toggle.addEventListener('click', function(e){
      if(window.innerWidth <= 991){
        e.preventDefault(); 
        e.stopPropagation();
        
        const dd = this.closest('.dropdown');
        const menu = dd?.querySelector('.dropdown-menu');
        if(!dd || !menu) return;

        // Close other dropdowns
        document.querySelectorAll('.dropdown-menu.show').forEach(other=>{
          if(other !== menu){ 
            other.classList.remove('show'); 
            other.closest('.dropdown')?.classList.remove('show'); 
          }
        });

        // Toggle current
        const isShowing = menu.classList.contains('show');
        if(isShowing) {
          menu.classList.remove('show');
          dd.classList.remove('show');
          this.setAttribute('aria-expanded', 'false');
        } else {
          menu.classList.add('show');
          dd.classList.add('show');
          this.setAttribute('aria-expanded', 'true');
        }
      }
    });
  });

  document.querySelectorAll('.dropdown-menu').forEach(menu=>{
    menu.addEventListener('click', e=>{ 
      if(window.innerWidth <= 991) e.stopPropagation(); 
    });
  });

  // ===== Smooth Scroll for Contact Link =====
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      const href = this.getAttribute('href');
      if(href === '#footer-contact') {
        e.preventDefault();
        const footer = document.querySelector('.main-footer .contact-info');
        if(footer) {
          footer.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          
          // Close mobile menu if open
          if(window.innerWidth <= 991 && navCollapse?.classList.contains('show')){
            navCollapse.classList.remove('show');
            toggler.setAttribute('aria-expanded', 'false');
          }
        }
      }
    });
  });
})();
</script>

</body>
</html>