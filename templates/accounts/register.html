</style>
</head>
<body>
    <div class="auth-container">
        <div class="auth-header">
            <div class="logo-container">
                <img src="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png" 
                     alt="وش الجواب" 
                     class="logo-img">
            </div>
            <h1 class="auth-title">إنشاء حساب جديد</h1>
            <p class="auth-subtitle">أنشئ حسابك للانضمام إلى المنصة</p>
        </div>

        <!-- رسائل التنبيه -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {% if message.tags == 'success' %}
                        <i class="fas fa-check-circle me-2"></i>
                    {% else %}
                        <i class="fas fa-exclamation-triangle me-2"></i>
                    {% endif %}
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <form method="post" action="{% url 'accounts:register' %}" id="registerForm" novalidate>
            {% csrf_token %}
            
            <!-- الاسم ومعرف المستخدم -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="first_name">
                        <i class="fas fa-user me-1"></i>
                        الاسم الأول
                    </label>
                    <div class="position-relative">
                        <input 
                            type="text" 
                            class="form-control with-icon" 
                            id="first_name" 
                            name="first_name" 
                            placeholder="أدخل اسمك الأول"
                            required
                            autocomplete="given-name"
                        >
                        <i class="fas fa-user input-icon"></i>
                        <i class="fas fa-check form-validation-icon valid"></i>
                        <i class="fas fa-times form-validation-icon invalid"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="username">
                        <i class="fas fa-at me-1"></i>
                        اسم المستخدم
                    </label>
                    <div class="position-relative">
                        <input 
                            type="text" 
                            class="form-control with-icon" 
                            id="username" 
                            name="username" 
                            placeholder="اختر اسم المستخدم"
                            required
                            autocomplete="username"
                        >
                        <i class="fas fa-at input-icon"></i>
                        <i class="fas fa-check form-validation-icon valid"></i>
                        <i class="fas fa-times form-validation-icon invalid"></i>
                    </div>
                </div>
            </div>

            <!-- البريد الإلكتروني -->
            <div class="form-group">
                <label class="form-label" for="email">
                    <i class="fas fa-envelope me-1"></i>
                    البريد الإلكتروني
                </label>
                <div class="position-relative">
                    <input 
                        type="email" 
                        class="form-control with-icon" 
                        id="email" 
                        name="email" 
                        placeholder="أدخل بريدك الإلكتروني"
                        required
                        autocomplete="email"
                    >
                    <i class="fas fa-envelope input-icon"></i>
                    <i class="fas fa-check form-validation-icon valid"></i>
                    <i class="fas fa-times form-validation-icon invalid"></i>
                </div>
            </div>

            <!-- اسم المقدم ورقم الهاتف -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="host_name">
                        <i class="fas fa-microphone me-1"></i>
                        اسم المقدم (اختياري)
                    </label>
                    <div class="position-relative">
                        <input 
                            type="text" 
                            class="form-control with-icon" 
                            id="host_name" 
                            name="host_name" 
                            placeholder="اسمك كمقدم"
                            autocomplete="name"
                        >
                        <i class="fas fa-microphone input-icon"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="phone_number">
                        <i class="fas fa-phone me-1"></i>
                        رقم الهاتف (اختياري)
                    </label>
                    <div class="position-relative">
                        <input 
                            type="tel" 
                            class="form-control with-icon" 
                            id="phone_number" 
                            name="phone_number" 
                            placeholder="05xxxxxxxx"
                            autocomplete="tel"
                        >
                        <i class="fas fa-phone input-icon"></i>
                    </div>
                </div>
            </div>

            <!-- كلمة المرور -->
            <div class="form-group">
                <label class="form-label" for="password1">
                    <i class="fas fa-lock me-1"></i>
                    كلمة المرور
                </label>
                <div class="position-relative">
                    <input 
                        type="password" 
                        class="form-control with-icon" 
                        id="password1" 
                        name="password1" 
                        placeholder="أدخل كلمة مرور قوية"
                        required
                        autocomplete="new-password"
                    >
                    <i class="fas fa-lock input-icon"></i>
                    <i class="fas fa-eye" id="togglePassword1" style="position: absolute; right: 18px; top: 50%; transform: translateY(-50%); cursor: pointer; color: rgba(255,255,255,0.6);"></i>
                </div>
                <div class="password-strength">
                    <div class="password-strength-fill" id="passwordStrengthFill"></div>
                </div>
                <div class="password-requirements" id="passwordRequirements">
                    <div class="requirement" id="req-length">
                        <i class="fas fa-times"></i>
                        <span>8 أحرف على الأقل</span>
                    </div>
                    <div class="requirement" id="req-uppercase">
                        <i class="fas fa-times"></i>
                        <span>حرف كبير واحد على الأقل</span>
                    </div>
                    <div class="requirement" id="req-number">
                        <i class="fas fa-times"></i>
                        <span>رقم واحد على الأقل</span>
                    </div>
                </div>
            </div>

            <!-- تأكيد كلمة المرور -->
            <div class="form-group">
                <label class="form-label" for="password2">
                    <i class="fas fa-lock me-1"></i>
                    تأكيد كلمة المرور
                </label>
                <div class="position-relative">
                    <input 
                        type="password" 
                        class="form-control with-icon" 
                        id="password2" 
                        name="password2" 
                        placeholder="أعد إدخال كلمة المرور"
                        required
                        autocomplete="new-password"
                    >
                    <i class="fas fa-lock input-icon"></i>
                    <i class="fas fa-eye" id="togglePassword2" style="position: absolute; right: 18px; top: 50%; transform: translateY(-50%); cursor: pointer; color: rgba(255,255,255,0.6);"></i>
                    <i class="fas fa-check form-validation-icon valid"></i>
                    <i class="fas fa-times form-validation-icon invalid"></i>
                </div>
            </div>

            <!-- الموافقة على الشروط -->
            <div class="form-check">
                <input 
                    class="form-check-input" 
                    type="checkbox" 
                    id="terms_agreement" 
                    name="terms_agreement"
                    required
                >
                <label class="form-check-label" for="terms_agreement">
                    أوافق على <a href="#" target="_blank">شروط الاستخدام</a> و<a href="#" target="_blank">سياسة الخصوصية</a>
                    وأؤكد أنني أبلغ من العمر 13 عاماً أو أكثر
                </label>
            </div>

            <button type="submit" class="btn-register" id="registerBtn">
                <span class="btn-text">إنشاء الحساب</span>
                <div class="loading">
                    <div class="spinner"></div>
                </div>
                <div class="success-animation">
                    <i class="fas fa-check"></i>
                </div>
            </button>
        </form>

        <div class="divider">
            <span>أو</span>
        </div>

        <div class="auth-links">
            <p class="mb-0">
                لديك حساب بالفعل؟ 
                <a href="{% url 'accounts:login' %}" class="auth-link">
                    <i class="fas fa-sign-in-alt me-1"></i>
                    تسجيل الدخول
                </a>
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registerForm');
            const registerBtn = document.getElementById('registerBtn');
            const btnText = registerBtn.querySelector('.btn-text');
            const loading = registerBtn.querySelector('.loading');
            const successAnimation = registerBtn.querySelector('.success-animation');

            // عناصر كلمة المرور
            const password1 = document.getElementById('password1');
            const password2 = document.getElementById('password2');
            const strengthFill = document.getElementById('passwordStrengthFill');
            const requirements = document.getElementById('passwordRequirements');

            // متطلبات كلمة المرور
            const reqLength = document.getElementById('req-length');
            const reqUppercase = document.getElementById('req-uppercase');
            const reqNumber = document.getElementById('req-number');

            // إظهار/إخفاء كلمة المرور
            document.getElementById('togglePassword1').addEventListener('click', function() {
                togglePasswordVisibility(password1, this);
            });

            document.getElementById('togglePassword2').addEventListener('click', function() {
                togglePasswordVisibility(password2, this);
            });

            function togglePasswordVisibility(input, icon) {
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            }

            // تحقق من قوة كلمة المرور
            password1.addEventListener('input', function() {
                const password = this.value;
                let strength = 0;
                
                // التحقق من الطول
                if (password.length >= 8) {
                    reqLength.classList.add('met');
                    reqLength.querySelector('i').classList.remove('fa-times');
                    reqLength.querySelector('i').classList.add('fa-check');
                    strength++;
                } else {
                    reqLength.classList.remove('met');
                    reqLength.querySelector('i').classList.remove('fa-check');
                    reqLength.querySelector('i').classList.add('fa-times');
                }

                // التحقق من الحروف الكبيرة
                if (/[A-Z]/.test(password)) {
                    reqUppercase.classList.add('met');
                    reqUppercase.querySelector('i').classList.remove('fa-times');
                    reqUppercase.querySelector('i').classList.add('fa-check');
                    strength++;
                } else {
                    reqUppercase.classList.remove('met');
                    reqUppercase.querySelector('i').classList.remove('fa-check');
                    reqUppercase.querySelector('i').classList.add('fa-times');
                }

                // التحقق من الأرقام
                if (/[0-9]/.test(password)) {
                    reqNumber.classList.add('met');
                    reqNumber.querySelector('i').classList.remove('fa-times');
                    reqNumber.querySelector('i').classList.add('fa-check');
                    strength++;
                } else {
                    reqNumber.classList.remove('met');
                    reqNumber.querySelector('i').classList.remove('fa-check');
                    reqNumber.querySelector('i').classList.add('fa-times');
                }

                // تحديث شريط القوة
                strengthFill.className = 'password-strength-fill';
                if (strength === 1) strengthFill.classList.add('strength-weak');
                else if (strength === 2) strengthFill.classList.add('strength-fair');
                else if (strength === 3) strengthFill.classList.add('strength-strong');

                // إظهار/إخفاء المتطلبات
                requirements.style.display = password.length > 0 ? 'block' : 'none';
            });

            // التحقق من تطابق كلمة المرور
            function checkPasswordMatch() {
                const isMatch = password1.value && password2.value && password1.value === password2.value;
                
                if (password2.value.length > 0) {
                    if (isMatch) {
                        password2.classList.add('valid');
                        password2.classList.remove('invalid');
                    } else {
                        password2.classList.add('invalid');
                        password2.classList.remove('valid');
                    }
                } else {
                    password2.classList.remove('valid', 'invalid');
                }
            }

            password1.addEventListener('input', checkPasswordMatch);
            password2.addEventListener('input', checkPasswordMatch);

            // التحقق من صحة جميع الحقول
            const inputs = document.querySelectorAll('.form-control');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    validateField(this);
                });

                input.addEventListener('blur', function() {
                    validateField(this);
                });

                // تأثيرات التفاعل
                input.addEventListener('focus', function() {
                    this.parentElement.style.transform = 'scale(1.02)';
                });

                input.addEventListener('blur', function() {
                    this.parentElement.style.transform = 'scale(1)';
                });
            });

            function validateField(field) {
                const fieldType = field.type;
                const fieldValue = field.value.trim();

                // تجاهل الحقول الاختيارية الفارغة
                if (!field.required && !fieldValue) {
                    field.classList.remove('valid', 'invalid');
                    return;
                }

                let isValid = false;

                switch (fieldType) {
                    case 'email':
                        isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(fieldValue);
                        break;
                    case 'tel':
                        isValid = !fieldValue || /^05\d{8}$/.test(fieldValue);
                        break;
                    case 'text':
                        if (field.name === 'username') {
                            isValid = fieldValue.length >= 3 && /^[a-zA-Z0-9_]+$/.test(fieldValue);
                        } else {
                            isValid = fieldValue.length >= 2;
                        }
                        break;
                    default:
                        isValid = fieldValue.length > 0;
                }

                if (isValid) {
                    field.classList.add('valid');
                    field.classList.remove('invalid');
                } else {
                    field.classList.add('invalid');
                    field.classList.remove('valid');
                }
            }

            // معالجة إرسال النموذج
            form.addEventListener('submit', function(e) {
                e.preventDefault();

                // التحقق من صحة جميع البيانات
                let isFormValid = true;
                const formData = new FormData(form);

                // التحقق من الحقول المطلوبة
                const requiredFields = ['first_name', 'username', 'email', 'password1', 'password2'];
                requiredFields.forEach(fieldName => {
                    const field = document.getElementById(fieldName);
                    if (!field.value.trim()) {
                        isFormValid = false;
                        field.classList.add('invalid');
                        field.classList.remove('valid');
                    }
                });

                // التحقق من تطابق كلمة المرور
                if (password1.value !== password2.value) {
                    isFormValid = false;
                    showAlert('كلمات المرور غير متطابقة', 'danger');
                }

                // التحقق من قوة كلمة المرور
                const passwordStrength = getPasswordStrength(password1.value);
                if (passwordStrength < 2) {
                    isFormValid = false;
                    showAlert('كلمة المرور ضعيفة، يرجى اختيار كلمة مرور أقوى', 'danger');
                }

                // التحقق من الموافقة على الشروط
                if (!document.getElementById('terms_agreement').checked) {
                    isFormValid = false;
                    showAlert('يجب الموافقة على شروط الاستخدام', 'danger');
                }

                if (!isFormValid) {
                    return;
                }

                // إظهار حالة التحميل
                btnText.style.display = 'none';
                loading.style.display = 'block';
                registerBtn.disabled = true;

                // محاكاة معالجة الطلب
                setTimeout(() => {
                    // إظهار نجاح التسجيل
                    loading.style.display = 'none';
                    successAnimation.style.display = 'block';
                    
                    setTimeout(() => {
                        // إرسال النموذج فعلياً
                        form.submit();
                    }, 1000);
                }, 2000);
            });

            function getPasswordStrength(password) {
                let strength = 0;
                if (password.length >= 8) strength++;
                if (/[A-Z]/.test(password)) strength++;
                if (/[0-9]/.test(password)) strength++;
                if (/[^A-Za-z0-9]/.test(password)) strength++;
                return strength;
            }

            // إظهار تنبيه
            function showAlert(message, type) {
                // إزالة التنبيهات السابقة
                const existingAlerts = document.querySelectorAll('.alert');
                existingAlerts.forEach(alert => alert.remove());

                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
                const iconClass = type === 'success' ? 'check-circle' : 'exclamation-triangle';
                alertDiv.innerHTML = `
                    <i class="fas fa-${iconClass} me-2"></i>
                    ${message}
                `;
                
                const form = document.getElementById('registerForm');
                form.parentNode.insertBefore(alertDiv, form);

                // إزالة التنبيه تلقائياً
                setTimeout(() => {
                    alertDiv.remove();
                }, 5000);

                // إعادة تعيين الزر
                setTimeout(() => {
                    btnText.style.display = 'inline';
                    loading.style.display = 'none';
                    successAnimation.style.display = 'none';
                    registerBtn.disabled = false;
                }, 1000);
            }

            // تأثيرات بصرية إضافية
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('form-control')) {
                    createRipple(e);
                }
            });

            function createRipple(event) {
                const element = event.target;
                const ripple = document.createElement('span');
                const rect = element.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = event.clientX - rect.left - size / 2;
                const y = event.clientY - rect.top - size / 2;

                ripple.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 50%;
                    transform: scale(0);
                    animation: ripple 0.6s ease-out;
                    pointer-events: none;
                    z-index: 1000;
                `;

                element.style.position = 'relative';
                element.appendChild(ripple);

                setTimeout(() => ripple.remove(), 600);
            }

            // تحسين تجربة المستخدم للجوال
            if (window.innerWidth <= 768) {
                // تقليل التأثيرات للجوال لتحسين الأداء
                const animations = document.querySelectorAll('.floating');
                animations.forEach(el => {
                    el.style.animation = 'none';
                });
            }

            // تحسين إمكانية الوصول
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.target.tagName === 'INPUT') {
                    e.preventDefault();
                    const inputs = Array.from(document.querySelectorAll('input'));
                    const currentIndex = inputs.indexOf(e.target);
                    const nextInput = inputs[currentIndex + 1];
                    
                    if (nextInput) {
                        nextInput.focus();
                    } else {
                        form.submit();
                    }
                }
            });

            // تحسين الأداء - تأخير التحقق من صحة البيانات
            let validationTimeout;
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    clearTimeout(validationTimeout);
                    validationTimeout = setTimeout(() => {
                        validateField(this);
                    }, 300);
                });
            });

            // إضافة تأثيرات صوتية (اختيارية)
            function playSound(frequency, duration) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = frequency;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + duration);
                } catch (error) {
                    // تجاهل الأخطاء الصوتية
                }
            }

            // تشغيل صوت عند النجاح
            registerBtn.addEventListener('click', function() {
                if (this.querySelector('.success-animation').style.display === 'block') {
                    playSound(800, 0.2);
                }
            });

            // تحميل البيانات المحفوظة (إن وجدت)
            const savedData = localStorage.getItem('registerFormData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    Object.keys(data).forEach(key => {
                        const field = document.getElementById(key);
                        if (field && key !== 'password1' && key !== 'password2') {
                            field.value = data[key];
                        }
                    });
                } catch (error) {
                    // تجاهل أخطاء التحليل
                }
            }

            // حفظ البيانات أثناء الكتابة (باستثناء كلمات المرور)
            inputs.forEach(input => {
                if (input.type !== 'password') {
                    input.addEventListener('input', function() {
                        const formData = {};
                        inputs.forEach(inp => {
                            if (inp.type !== 'password' && inp.value) {
                                formData[inp.id] = inp.value;
                            }
                        });
                        localStorage.setItem('registerFormData', JSON.stringify(formData));
                    });
                }
            });

            // مسح البيانات المحفوظة عند إرسال النموذج بنجاح
            form.addEventListener('submit', function() {
                localStorage.removeItem('registerFormData');
            });
        });

        // إضافة الـ CSS للـ ripple effect
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(2);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>