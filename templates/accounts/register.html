<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إنشاء حساب - وش الجواب</title>

    <!-- Canonical + dynamic URL للـ OG -->
    <link rel="canonical" href="{% if request %}{{ request.build_absolute_uri }}{% else %}/accounts/register/{% endif %}">

    <!-- Open Graph -->
    <meta property="og:locale" content="ar_SA">
    <meta property="og:type" content="website">
    <meta property="og:title" content="إنشاء حساب - وش الجواب">
    <meta property="og:description" content="انضم إلى منصة وش الجواب للألعاب الذكية وابدأ رحلتك التفاعلية الآن.">
    <meta property="og:url" content="{% if request %}{{ request.build_absolute_uri }}{% else %}/accounts/register/{% endif %}">
    <meta property="og:site_name" content="وش الجواب">
    <meta property="og:image" content="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png">
    <meta property="og:image:secure_url" content="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png">
    <meta property="og:image:alt" content="شعار وش الجواب">
    <!-- <meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"> -->

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="إنشاء حساب - وش الجواب">
    <meta name="twitter:description" content="انضم إلى منصة وش الجواب للألعاب الذكية وابدأ رحلتك التفاعلية الآن.">
    <meta name="twitter:image" content="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png">

    <!-- PWA / Favicons -->
    <meta name="theme-color" content="#4f46e5">
    <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png">
    <link rel="apple-touch-icon" href="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png">
    <link rel="mask-icon" href="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png" color="#4f46e5">

    <!-- CSS Libs -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root{
            --primary-gradient: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            --secondary-gradient: linear-gradient(135deg, #8b5cf6 0%, #06b6d4 100%);
            --success-color:#10b981; --danger-color:#ef4444; --warning-color:#f59e0b;
            /* سطح المكتب */
            --glass-bg: rgba(255,255,255,0.12);
            --glass-border: rgba(255,255,255,0.22);
            --text-light:#f8fafc;
            /* الجوال: خلفية أغمق وأكثر راحة */
            --glass-bg-mobile: rgba(15,18,39,0.88);
            --glass-border-mobile: rgba(255,255,255,0.08);
            --field-bg-mobile: rgba(255,255,255,0.12);
        }

        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:'Tajawal',sans-serif;
            background:var(--primary-gradient);
            min-height:100vh; display:flex; align-items:center; justify-content:center;
            padding:20px; position:relative; overflow-x:hidden; color-scheme:dark;
        }

        /* خلفية زخرفية لطيفة */
        body::before{
            content:''; position:absolute; inset:0; z-index:-1;
            background:
                radial-gradient(circle at 20% 30%, rgba(79,70,229,0.28) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(124,58,237,0.26) 0%, transparent 50%),
                radial-gradient(circle at 60% 20%, rgba(251,146,60,0.16) 0%, transparent 50%);
            animation:floatingBubbles 20s ease-in-out infinite;
        }
        @keyframes floatingBubbles{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-20px) scale(1.05)}}

        .auth-container{
            background:var(--glass-bg);
            backdrop-filter:blur(18px); -webkit-backdrop-filter:blur(18px);
            border:1px solid var(--glass-border);
            border-radius:24px; padding:44px 40px 32px; width:100%; max-width:520px;
            box-shadow:0 25px 50px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.08);
            position:relative; animation:slideIn .6s ease-out;
        }
        @keyframes slideIn{from{opacity:0;transform:translateY(30px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}

        .auth-header{text-align:center;margin-bottom:26px}
        /* شعار كبير وبروز أعلى */
        .logo-link{display:inline-block;text-decoration:none}
        .logo-container{
            width:160px;height:160px; /* أكبر */
            margin:0 auto 14px;
            background:rgba(255,255,255,.18); border-radius:28px; padding:18px;
            display:flex;align-items:center;justify-content:center;
            box-shadow:0 22px 44px rgba(0,0,0,.24), 0 0 90px rgba(124,58,237,.30), inset 0 2px 16px rgba(255,255,255,.28);
            backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px);
            border:2px solid rgba(255,255,255,.28); animation:logoFloat 4s ease-in-out infinite;
        }
        .logo-img{width:100%;height:100%;object-fit:contain;border-radius:14px;filter:drop-shadow(0 6px 12px rgba(0,0,0,.35));transition:transform .25s ease, filter .25s ease}
        .logo-link:hover .logo-img{transform:scale(1.02);filter:drop-shadow(0 8px 16px rgba(0,0,0,.4))}
        @keyframes logoFloat{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-8px) scale(1.02)}}

        .auth-title{font-size:2rem;font-weight:800;color:#fff;margin-bottom:4px;text-shadow:2px 2px 4px rgba(0,0,0,.08)}
        .auth-subtitle{color:rgba(255,255,255,.9);font-size:1rem}

        .form-group{position:relative;margin-bottom:20px}
        .form-label{color:#fff;font-weight:600;margin-bottom:8px;display:block;font-size:.98rem}

        .form-control{
            background:rgba(255,255,255,.12); border:2px solid rgba(255,255,255,.22);
            border-radius:14px; padding:14px 20px; color:#fff; width:100%;
            transition:all .2s ease; backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
        }
        .form-control:focus{
            outline:none; border-color:rgba(124,58,237,.95);
            background:rgba(255,255,255,.16);
            box-shadow:0 0 0 4px rgba(124,58,237,.14);
            transform:translateY(-1px);
        }
        .form-control::placeholder{color:rgba(255,255,255,.7)}
        .input-icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:rgba(255,255,255,.75);font-size:1.1rem}
        .form-control.with-icon{padding-left:46px}

        .password-toggle{position:absolute;left:46px;top:50%;transform:translateY(-50%);cursor:pointer;color:rgba(255,255,255,.75);z-index:10}
        .password-toggle:hover{color:#fff}

        .text-danger{color:#fca5a5!important;font-size:.85rem;margin-top:5px}
        .text-muted{color:rgba(255,255,255,.66)!important;font-size:.8rem;margin-top:5px}

        .password-strength{height:4px;background:rgba(255,255,255,.1);border-radius:2px;margin-top:8px;overflow:hidden}
        .password-strength-fill{height:100%;width:0%;transition:width .3s ease;border-radius:2px}
        .strength-weak{background:var(--danger-color);width:30%}
        .strength-fair{background:var(--warning-color);width:60%}
        .strength-strong{background:var(--success-color);width:100%}

        .btn-register{
            background:var(--secondary-gradient); border:none; border-radius:14px; padding:15px 30px;
            color:#fff; font-size:1.1rem; font-weight:800; width:100%;
            cursor:pointer; transition:transform .15s ease, box-shadow .15s ease;
            box-shadow:0 12px 26px rgba(139,92,246,.38); position:relative; overflow:hidden; margin-top:10px;
        }
        .btn-register:hover{transform:translateY(-2px);box-shadow:0 16px 34px rgba(139,92,246,.48)}
        .btn-register:disabled{opacity:.78;cursor:not-allowed}

        .auth-links{text-align:center;margin-top:24px;padding-top:18px;border-top:1px solid rgba(255,255,255,.12)}
        .auth-link{color:rgba(255,255,255,.9);text-decoration:none;font-weight:700}
        .auth-link:hover{color:#fff;text-decoration:underline}

        .alert{border-radius:12px;border:none;padding:15px 20px;margin-bottom:22px;backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)}
        .alert-success{background:rgba(16,185,129,.2);color:#34d399;border:1px solid rgba(16,185,129,.3)}
        .alert-danger,.alert-error{background:rgba(239,68,68,.2);color:#fca5a5;border:1px solid rgba(239,68,68,.3)}

        .loading{display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}
        .spinner{width:20px;height:20px;border:2px solid rgba(255,255,255,.3);border-top:2px solid #fff;border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}

        /* الجوال: تقليل الشفافية/الزخارف وتكبير الشعار */
        @media (max-width:768px){
            .auth-container{
                padding:32px 22px 24px;
                max-width:94vw;
                background:var(--glass-bg-mobile);
                backdrop-filter:none; -webkit-backdrop-filter:none;
                border:1px solid var(--glass-border-mobile);
                box-shadow:0 22px 46px rgba(0,0,0,.30);
            }
            body::before{
                background:
                    radial-gradient(circle at 20% 30%, rgba(79,70,229,.18) 0%, transparent 50%),
                    radial-gradient(circle at 80% 70%, rgba(124,58,237,.16) 0%, transparent 50%),
                    radial-gradient(circle at 60% 20%, rgba(251,146,60,.10) 0%, transparent 50%);
                animation:none;
            }
            .logo-container{width:140px;height:140px;padding:16px;animation:none} /* شعار أكبر على الجوال */
            .auth-title{font-size:1.8rem}
            .form-control{background:var(--field-bg-mobile);border-color:rgba(255,255,255,.22);padding:13px 16px}
            .form-control.with-icon{padding-left:44px}
        }
        @media (max-width:480px){
            .logo-container{width:130px;height:130px}
            .auth-title{font-size:1.6rem}
        }

        /* احترام تفضيل تقليل الحركة */
        @media (prefers-reduced-motion: reduce){ *{animation:none!important;transition:none!important} }
    </style>
</head>
<body>
    <div class="auth-container" role="main" aria-labelledby="registerTitle">
        <div class="auth-header">
            <!-- شعار قابل للنقر للرجوع للرئيسية -->
            <a href="{% url 'home' %}" class="logo-link" aria-label="العودة للرئيسية">
                <div class="logo-container" aria-hidden="true">
                    <img src="https://res.cloudinary.com/drbfhq7t1/image/upload/v1754178528/weshaljawab_tltnqt.png"
                         alt="وش الجواب" class="logo-img" width="160" height="160"
                         loading="eager" decoding="async">
                </div>
            </a>
            <h1 class="auth-title" id="registerTitle">إنشاء حساب جديد</h1>
            <p class="auth-subtitle">املأ النموذج للبدء في رحلتك معنا</p>
        </div>

        <!-- رسائل التنبيه العامة -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {% if message.tags == 'success' %}
                        <i class="fas fa-check-circle me-2" aria-hidden="true"></i>
                    {% else %}
                        <i class="fas fa-exclamation-triangle me-2" aria-hidden="true"></i>
                    {% endif %}
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <form method="post" action="{% url 'accounts:register' %}" id="registerForm" novalidate>
        {% csrf_token %}

        <!-- الاسم -->
        <div class="form-group">
            <label class="form-label" for="{{ form.first_name.id_for_label }}">
                <i class="fas fa-user me-1" aria-hidden="true"></i> {{ form.first_name.label }}
            </label>
            <div class="position-relative">
                <input type="text" class="form-control with-icon"
                    id="{{ form.first_name.id_for_label }}" name="{{ form.first_name.name }}"
                    value="{{ form.first_name.value|default:'' }}"
                    placeholder="{{ form.first_name.field.widget.attrs.placeholder }}"
                    required
                    inputmode="{{ form.first_name.field.widget.attrs.inputmode }}"
                    autocomplete="{{ form.first_name.field.widget.attrs.autocomplete }}"
                    {% if form.first_name.field.widget.attrs.autofocus %}autofocus{% endif %}>
                <i class="fas fa-user input-icon" aria-hidden="true"></i>
            </div>
            {% if form.first_name.errors %}
                {% for error in form.first_name.errors %}
                    <small class="text-danger d-block">{{ error }}</small>
                {% endfor %}
            {% endif %}
        </div>

        <!-- البريد الإلكتروني -->
        <div class="form-group">
            <label class="form-label" for="{{ form.email.id_for_label }}">
                <i class="fas fa-envelope me-1" aria-hidden="true"></i> {{ form.email.label }}
            </label>
            <div class="position-relative">
                <input type="email" class="form-control with-icon"
                    id="{{ form.email.id_for_label }}" name="{{ form.email.name }}"
                    value="{{ form.email.value|default:'' }}"
                    placeholder="{{ form.email.field.widget.attrs.placeholder }}"
                    required
                    inputmode="{{ form.email.field.widget.attrs.inputmode }}"
                    autocomplete="{{ form.email.field.widget.attrs.autocomplete }}">
                <i class="fas fa-envelope input-icon" aria-hidden="true"></i>
            </div>
            {% if form.email.errors %}
                {% for error in form.email.errors %}
                    <small class="text-danger d-block">{{ error }}</small>
                {% endfor %}
            {% endif %}
        </div>

        <!-- كلمة المرور -->
        <div class="form-group">
            <label class="form-label" for="{{ form.password.id_for_label }}">
                <i class="fas fa-lock me-1" aria-hidden="true"></i> {{ form.password.label }}
            </label>
            <div class="position-relative">
                <input type="password" class="form-control with-icon"
                    id="{{ form.password.id_for_label }}" name="{{ form.password.name }}"
                    placeholder="{{ form.password.field.widget.attrs.placeholder }}"
                    required minlength="{{ form.password.field.min_length }}"
                    autocomplete="{{ form.password.field.widget.attrs.autocomplete }}">
                <i class="fas fa-lock input-icon" aria-hidden="true"></i>
                <button type="button" class="password-toggle btn btn-link p-0 text-decoration-none"
                        id="togglePassword" aria-label="إظهار/إخفاء كلمة المرور" title="إظهار/إخفاء كلمة المرور">
                    <i class="fas fa-eye" aria-hidden="true"></i>
                </button>
            </div>
            {% if form.password.errors %}
                {% for error in form.password.errors %}
                    <small class="text-danger d-block">{{ error }}</small>
                {% endfor %}
            {% endif %}
            <div class="password-strength">
                <div class="password-strength-fill" id="passwordStrengthFill"></div>
            </div>
        </div>

        <!-- رقم الجوال -->
        <div class="form-group">
            <label class="form-label" for="{{ form.phone_number.id_for_label }}">
                <i class="fas fa-phone me-1" aria-hidden="true"></i> {{ form.phone_number.label }}
            </label>
            <div class="position-relative">
                <input type="tel" class="form-control with-icon"
                    id="{{ form.phone_number.id_for_label }}" name="{{ form.phone_number.name }}"
                    value="{{ form.phone_number.value|default:'' }}"
                    placeholder="{{ form.phone_number.field.widget.attrs.placeholder }}"
                    required
                    pattern="{{ form.phone_number.field.widget.attrs.pattern }}"
                    inputmode="{{ form.phone_number.field.widget.attrs.inputmode }}"
                    autocomplete="{{ form.phone_number.field.widget.attrs.autocomplete }}">
                <i class="fas fa-phone input-icon" aria-hidden="true"></i>
            </div>
            {% if form.phone_number.errors %}
                {% for error in form.phone_number.errors %}
                    <small class="text-danger d-block">{{ error }}</small>
                {% endfor %}
            {% endif %}
            <small class="text-muted d-block">يجب أن يبدأ الرقم بـ 05 ويتكون من 10 أرقام</small>
        </div>

        <button type="submit" class="btn-register" id="registerBtn">
            <span class="btn-text">إنشاء الحساب</span>
            <div class="loading"><div class="spinner" role="status" aria-label="جاري التحميل"></div></div>
        </button>
        </form>

        <div class="auth-links">
            <p class="mb-0">
                لديك حساب بالفعل؟
                <a href="{% url 'accounts:login' %}" class="auth-link">
                    <i class="fas fa-sign-in-alt me-1" aria-hidden="true"></i>
                    تسجيل الدخول
                </a>
            </p>
        </div>
    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <script>
    document.addEventListener('DOMContentLoaded', function(){
        const form = document.getElementById('registerForm');
        const registerBtn = document.getElementById('registerBtn');
        const btnText = registerBtn.querySelector('.btn-text');
        const loading = registerBtn.querySelector('.loading');

        const password = document.getElementById('{{ form.password.id_for_label }}');
        const togglePasswordBtn = document.getElementById('togglePassword');
        const togglePasswordIcon = togglePasswordBtn.querySelector('i');
        const strengthFill = document.getElementById('passwordStrengthFill');

        // إظهار/إخفاء كلمة المرور
        togglePasswordBtn.addEventListener('click', function(){
            const hidden = password.type === 'password';
            password.type = hidden ? 'text' : 'password';
            togglePasswordIcon.classList.toggle('fa-eye', !hidden);
            togglePasswordIcon.classList.toggle('fa-eye-slash', hidden);
            this.setAttribute('aria-pressed', String(hidden));
        });

        // قياس قوة كلمة المرور
        password.addEventListener('input', function(){
            const val = this.value;
            let strength = 0;
            if (val.length >= 8) strength++;
            if (/[A-Z]/.test(val)) strength++;
            if (/[a-z]/.test(val)) strength++;
            if (/[0-9]/.test(val)) strength++;
            if (/[^A-Za-z0-9]/.test(val)) strength++;

            strengthFill.className = 'password-strength-fill';
            if (strength <= 2) strengthFill.classList.add('strength-weak');
            else if (strength <= 4) strengthFill.classList.add('strength-fair');
            else strengthFill.classList.add('strength-strong');
        });

        // إرسال النموذج مع تحقق أساسي
        form.addEventListener('submit', function(e){
            const email = document.getElementById('{{ form.email.id_for_label }}').value.trim().toLowerCase();
            const phone = document.getElementById('{{ form.phone_number.id_for_label }}').value.trim();
            const name = document.getElementById('{{ form.first_name.id_for_label }}').value.trim();

            if (!name || !email || !password.value || !phone){
                e.preventDefault();
                showAlert('يرجى ملء جميع الحقول المطلوبة', 'danger');
                return;
            }
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)){
                e.preventDefault();
                showAlert('البريد الإلكتروني غير صحيح', 'danger');
                return;
            }
            if (!/^05\d{8}$/.test(phone)){
                e.preventDefault();
                showAlert('رقم الجوال غير صحيح. يجب أن يبدأ بـ 05 ويتكون من 10 أرقام', 'danger');
                return;
            }

            // تحضير للإرسال
            btnText.style.display = 'none';
            loading.style.display = 'block';
            registerBtn.disabled = true;
        });

        function showAlert(message, type){
            const el = document.createElement('div');
            el.className = `alert alert-${type} alert-dismissible fade show`;
            el.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2" aria-hidden="true"></i>${message}`;
            const header = document.querySelector('.auth-header');
            header.parentNode.insertBefore(el, form);
            setTimeout(()=>{ el?.remove(); }, 5000);
            setTimeout(()=>{
                btnText.style.display = 'inline';
                loading.style.display = 'none';
                registerBtn.disabled = false;
            }, 800);
        }

        // تقليل الحركة عند تفضيل المستخدم
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches){
            document.body.style.animation = 'none';
            const logo = document.querySelector('.logo-container');
            if (logo) logo.style.animation = 'none';
        }

        // إزالة رسائل التنبيه من Django بعد فترة
        document.querySelectorAll('.alert').forEach(a => setTimeout(()=>a?.remove(), 5000));
    });
    </script>
</body>
</html>
