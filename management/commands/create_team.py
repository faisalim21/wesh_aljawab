from django.core.management.base import BaseCommand
from django.contrib.auth.models import User, Group

class Command(BaseCommand):
    help = 'ุฅูุดุงุก ุญุณุงุจุงุช ูุฑูู ุฅุนุฏุงุฏ ุงูุฃุณุฆูุฉ'

    def add_arguments(self, parser):
        parser.add_argument('--ุงุณู_ุงููุณุชุฎุฏู', type=str, help='ุงุณู ุงููุณุชุฎุฏู ูููุฑูู')
        parser.add_argument('--ุงูุงูููู', type=str, help='ุงูุจุฑูุฏ ุงูุฅููุชุฑููู')
        parser.add_argument('--ูููุฉ_ุงููุฑูุฑ', type=str, help='ูููุฉ ุงููุฑูุฑ')

    def handle(self, *args, **options):
        # ุงูุชุฃูุฏ ูู ูุฌูุฏ ูุฌููุนุฉ ูุฑูู ุฅุนุฏุงุฏ ุงูุฃุณุฆูุฉ
        ูุฑูู_ุงูุงุณุฆูุฉ, ุชู_ุงูุงูุดุงุก = Group.objects.get_or_create(name='ูุฑูู ุฅุนุฏุงุฏ ุงูุฃุณุฆูุฉ')
        
        if ุชู_ุงูุงูุดุงุก:
            self.stdout.write(
                self.style.SUCCESS('โ ุชู ุฅูุดุงุก ูุฌููุนุฉ "ูุฑูู ุฅุนุฏุงุฏ ุงูุฃุณุฆูุฉ"')
            )

        # ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ ุฅุฐุง ุชู ุชูุฑูุฑ ุงูุจูุงูุงุช
        if options['ุงุณู_ุงููุณุชุฎุฏู'] and options['ุงูุงูููู'] and options['ูููุฉ_ุงููุฑูุฑ']:
            ุงุณู_ุงููุณุชุฎุฏู = options['ุงุณู_ุงููุณุชุฎุฏู']
            ุงูุงูููู = options['ุงูุงูููู']
            ูููุฉ_ุงููุฑูุฑ = options['ูููุฉ_ุงููุฑูุฑ']
            
            if User.objects.filter(username=ุงุณู_ุงููุณุชุฎุฏู).exists():
                self.stdout.write(
                    self.style.ERROR(f'โ ุงููุณุชุฎุฏู {ุงุณู_ุงููุณุชุฎุฏู} ููุฌูุฏ ุจุงููุนู')
                )
                return
            
            # ุฅูุดุงุก ุงููุณุชุฎุฏู
            ุงููุณุชุฎุฏู = User.objects.create_user(
                username=ุงุณู_ุงููุณุชุฎุฏู,
                email=ุงูุงูููู,
                password=ูููุฉ_ุงููุฑูุฑ,
                is_staff=True,  # ููููู ุงูุฏุฎูู ููุงุฌูุฉ ุงูุฅุฏุงุฑุฉ
                is_superuser=False  # ููุณ ูุฏูุฑ ูุงูู
            )
            
            # ุฅุถุงูุฉ ุงููุณุชุฎุฏู ููุฌููุนุฉ ูุฑูู ุฅุนุฏุงุฏ ุงูุฃุณุฆูุฉ
            ุงููุณุชุฎุฏู.groups.add(ูุฑูู_ุงูุงุณุฆูุฉ)
            
            self.stdout.write(
                self.style.SUCCESS(f'๐ ุชู ุฅูุดุงุก ุญุณุงุจ {ุงุณู_ุงููุณุชุฎุฏู} ุจูุฌุงุญ!')
            )
            self.stdout.write('๐ ุตูุงุญูุงุช ุงูุนุถู ุงูุฌุฏูุฏ:')
            self.stdout.write('   โ ุฅุถุงูุฉ ูุชุนุฏูู ุฃุณุฆูุฉ ุฎููุฉ ุงูุญุฑูู')
            self.stdout.write('   โ ุฅูุดุงุก ุญุฒู ุฌุฏูุฏุฉ ูุฎููุฉ ุงูุญุฑูู')
            self.stdout.write('   โ ุนุฑุถ ุงูุญุฒู ูุงูุฃุณุฆูุฉ ุงูููุฌูุฏุฉ')
            self.stdout.write('')
            self.stdout.write('โ ูุง ููููู:')
            self.stdout.write('   โ ุญุฐู ุฃู ุญุฒู ุฃู ุฃุณุฆูุฉ')
            self.stdout.write('   โ ุชุบููุฑ ุฃุณุนุงุฑ ุงูุญุฒู ุฃู ุชูุนูููุง')
            self.stdout.write('   โ ุฑุคูุฉ ุงููุดุชุฑูุงุช ุฃู ุงูุฃููุงู')
            self.stdout.write('   โ ุงููุตูู ูุฌูุณุงุช ุงููุนุจ')
        else:
            # ุนุฑุถ ุงูุชุนูููุงุช
            self.stdout.write(
                self.style.SUCCESS('๐ ุชุนูููุงุช ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ ููุฑูู ุฅุนุฏุงุฏ ุงูุฃุณุฆูุฉ:')
            )
            self.stdout.write('')
            self.stdout.write('ุงุณุชุฎุฏู ุงูุฃูุฑ ุงูุชุงูู:')
            self.stdout.write(
                'python manage.py ุงูุดุงุก_ูุฑูู --ุงุณู_ุงููุณุชุฎุฏู ุงุญูุฏ --ุงูุงูููู ahmed@example.com --ูููุฉ_ุงููุฑูุฑ ูููุฉ_ุณุฑูุฉ'
            )
            self.stdout.write('')
            
        # ุนุฑุถ ุฃุนุถุงุก ุงููุฑูู ุงูุญุงูููู
        ุงุนุถุงุก_ุงููุฑูู = User.objects.filter(groups=ูุฑูู_ุงูุงุณุฆูุฉ)
        if ุงุนุถุงุก_ุงููุฑูู.exists():
            self.stdout.write(
                self.style.SUCCESS('๐ฅ ุฃุนุถุงุก ูุฑูู ุฅุนุฏุงุฏ ุงูุฃุณุฆูุฉ ุงูุญุงูููู:')
            )
            for ุนุถู in ุงุนุถุงุก_ุงููุฑูู:
                ุญุงูุฉ = "๐ข ูุดุท" if ุนุถู.is_active else "๐ด ุบูุฑ ูุดุท"
                self.stdout.write(f'   โข {ุนุถู.username} ({ุนุถู.email}) - {ุญุงูุฉ}')
        else:
            self.stdout.write(
                self.style.WARNING('๐ ูุง ููุฌุฏ ุฃุนุถุงุก ูู ูุฑูู ุฅุนุฏุงุฏ ุงูุฃุณุฆูุฉ ุญุชู ุงูุขู')
            )
            
        self.stdout.write('')
        self.stdout.write(
            self.style.SUCCESS('๐ก ุชุฐููุฑ: ุฃูุช (ุงููุฏูุฑ ุงููุงูู) ูุฏูู ูู ุงูุตูุงุญูุงุช')
        )
        self.stdout.write('   โ ุฅุฏุงุฑุฉ ุงูุฃุณุนุงุฑ ูุงูุชูุนูู')
        self.stdout.write('   โ ุญุฐู ุงูุญุฒู ูุงูุฃุณุฆูุฉ')
        self.stdout.write('   โ ูุฑุงูุจุฉ ุงููุดุชุฑูุงุช ูุงูุฅุญุตุงุฆูุงุช')
        self.stdout.write('   โ ุฅุฏุงุฑุฉ ุฌูุณุงุช ุงููุนุจ')